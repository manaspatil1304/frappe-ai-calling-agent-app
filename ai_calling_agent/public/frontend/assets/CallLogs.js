var W=Object.defineProperty;var N=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var S=(p,n,l)=>n in p?W(p,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):p[n]=l,$=(p,n)=>{for(var l in n||(n={}))G.call(n,l)&&S(p,l,n[l]);if(N)for(var l of N(n))J.call(n,l)&&S(p,l,n[l]);return p};var k=(p,n,l)=>new Promise((a,v)=>{var b=c=>{try{x(l.next(c))}catch(_){v(_)}},w=c=>{try{x(l.throw(c))}catch(_){v(_)}},x=c=>c.done?a(c.value):Promise.resolve(c.value).then(b,w);x((l=l.apply(p,n)).next())});import{d as y,c as K,e as u,f as t,g,w as i,u as r,B as h,F as O,h as q,D as T,o as m,_ as F,t as d,n as V,l as f,i as A,z as C,A as I,C as M}from"./vendor.js";const Q={class:"p-8 max-w-7xl mx-auto"},X={class:"flex justify-between items-center mb-6"},Y=t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-900"},"Call Logs"),t("p",{class:"text-sm text-gray-500 mt-1"},"History of AI interactions")],-1),Z=f(" Refresh "),tt={class:"bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden"},et={class:"w-full text-left text-sm"},st=t("thead",{class:"bg-gray-50 border-b border-gray-200 text-gray-500 font-medium"},[t("tr",null,[t("th",{class:"px-6 py-3"},"ID & Date"),t("th",{class:"px-6 py-3"},"Contact"),t("th",{class:"px-6 py-3"},"Phone"),t("th",{class:"px-6 py-3"},"Duration"),t("th",{class:"px-6 py-3"},"Call Status"),t("th",{class:"px-6 py-3"},"Lead Status"),t("th",{class:"px-6 py-3 text-right"},"Actions")])],-1),at={class:"divide-y divide-gray-100"},ot={key:0},lt=t("td",{colspan:"7",class:"p-6 text-center text-gray-500"},"Loading logs...",-1),nt=[lt],rt={key:1},it=t("td",{colspan:"7",class:"p-6 text-center text-gray-500"}," No call logs found. ",-1),dt=[it],ct={class:"px-6 py-4"},ut={class:"font-medium text-gray-900"},gt={class:"text-xs text-gray-400 mt-0.5"},mt={class:"px-6 py-4 text-gray-900"},_t={class:"px-6 py-4 text-gray-600 font-mono"},pt={class:"px-6 py-4 font-mono text-gray-700"},xt={class:"px-6 py-4"},ft={class:"px-6 py-4"},vt={class:"px-6 py-4 text-right flex justify-end gap-2"},yt=f(" View "),ht={class:"text-xl font-bold"},bt={key:0,class:"mt-6 space-y-6"},wt={class:"grid grid-cols-1 md:grid-cols-3 gap-6 bg-gray-50 p-4 rounded-lg border border-gray-100"},Ct=t("label",{class:"block text-xs font-semibold text-gray-500 uppercase mb-1"},"Contact",-1),kt=["href"],Ft=t("label",{class:"block text-xs font-semibold text-gray-500 uppercase mb-1"},"LiveKit Room",-1),Lt=["title"],Dt=t("label",{class:"block text-xs font-semibold text-gray-500 uppercase mb-1"},"Duration",-1),Nt={class:"font-mono text-gray-900 font-bold"},St={key:0,class:"bg-white border border-gray-200 p-4 rounded-lg shadow-sm"},$t=t("label",{class:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2"},[t("span",{class:"text-lg"},"\u{1F399}\uFE0F"),f(" Call Recording ")],-1),Tt=["src"],Vt={key:1,class:"text-sm text-gray-500 italic bg-gray-50 p-3 rounded border border-gray-100"},At={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},It=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Call Status",-1),Mt=t("option",{value:"Pending"},"Pending",-1),Ut=t("option",{value:"Initiated"},"Initiated",-1),Bt=t("option",{value:"No Answer"},"No Answer",-1),Ht=t("option",{value:"Completed"},"Completed",-1),Rt=t("option",{value:"Failed"},"Failed",-1),Et=[Mt,Ut,Bt,Ht,Rt],jt=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Lead Status",-1),Pt=t("option",{value:"Hot"},"Hot",-1),zt=t("option",{value:"Warm"},"Warm",-1),Wt=t("option",{value:"Cold"},"Cold",-1),Gt=t("option",{value:"Negative"},"Negative",-1),Jt=t("option",{value:"Not a Lead"},"Not a Lead",-1),Kt=[Pt,zt,Wt,Gt,Jt],Ot={class:"flex justify-between items-center mb-1"},qt=t("label",{class:"block text-sm font-medium text-gray-700 flex items-center gap-2"},[t("span",{class:"text-lg"},"\u{1F916}"),f(" AI Summary ")],-1),Qt=["innerHTML"],Xt={class:"flex justify-between items-center mb-1"},Yt=t("label",{class:"block text-sm font-medium text-gray-700"},"Full Transcription",-1),Zt={class:"relative"},te=["innerHTML"],ee=f("Close"),se=f(" Save Changes "),ae=t("h3",{class:"text-xl font-bold text-red-600"},"Delete Call Log",-1),oe={class:"mt-4 text-gray-700"},le=t("p",{class:"mb-2"},"Are you sure you want to delete this call log?",-1),ne={class:"bg-gray-100 p-3 rounded text-sm font-mono font-bold text-gray-900 border border-gray-200"},re=t("p",{class:"mt-2 text-sm text-gray-500"},"This action cannot be undone.",-1),ie=f("Cancel"),de=f("Confirm Delete"),ge={setup(p){const n=y(!1),l=y(!1),a=y({}),v=y(null),b=y(!1),w=y(!1),x=y(!1),c=y(!1),_=K({url:"frappe.client.get_list",params:{doctype:"AI Call Log",fields:["name","party","party_type","phone_number","call_status","lead_status","livekit_room","transcription","ai_summary","creation","duration","recording_url"],order_by:"creation desc",limit:50},auto:!0});function L(o){if(!o)return"00:00";const e=Math.floor(o/60),s=Math.floor(o%60);return`${e.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`}function U(o){return o?new Date(o).toLocaleString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):""}function B(o){const e=(o||"").trim();return e==="Hot"?"bg-green-100 text-green-800":e==="Warm"?"bg-orange-100 text-orange-800":e==="Cold"?"bg-blue-100 text-blue-800":e==="Negative"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}function H(o){const e=(o||"").trim();return e==="Completed"?"bg-green-100 text-green-800":e==="Failed"?"bg-red-100 text-red-800":e==="Initiated"?"bg-blue-100 text-blue-800":e==="No Answer"?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"}function D(o){return o?o.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,'<strong class="text-gray-900 font-bold">$1</strong>').replace(/(Alex \(AI\):)/g,'<span class="text-[#4318FF] font-medium">$1</span>').replace(/^- (.*)/gm,'<li class="ml-4 list-disc">$1</li>'):'<span class="text-gray-400 italic">No data available.</span>'}function R(o){a.value=$({},o),x.value=!1,c.value=!1,n.value=!0}function E(){return k(this,null,function*(){b.value=!0;try{yield fetch(`/api/resource/AI Call Log/${a.value.name}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({call_status:a.value.call_status,lead_status:a.value.lead_status,ai_summary:a.value.ai_summary,transcription:a.value.transcription})}),yield _.fetch(),n.value=!1}catch(o){console.error(o),alert("Failed to save log.")}finally{b.value=!1}})}function j(o){v.value=o,l.value=!0}function P(){return k(this,null,function*(){if(!!v.value){w.value=!0;try{if((yield fetch(`/api/resource/AI Call Log/${v.value.name}`,{method:"DELETE"})).ok)yield _.fetch(),l.value=!1,v.value=null;else throw new Error("Server returned error")}catch(o){console.error(o),alert("Failed to delete log.")}finally{w.value=!1}}})}return(o,e)=>(m(),u("div",Q,[t("div",X,[Y,g(r(h),{variant:"solid",class:"!bg-[#4318FF] hover:!bg-[#3311CC] !text-white border-transparent",onClick:e[0]||(e[0]=s=>r(_).fetch())},{prefix:i(()=>[g(r(F),{name:"refresh-cw",class:"h-4 w-4"})]),default:i(()=>[Z]),_:1})]),t("div",tt,[t("table",et,[st,t("tbody",at,[r(_).loading?(m(),u("tr",ot,nt)):!r(_).data||r(_).data.length===0?(m(),u("tr",rt,dt)):(m(!0),u(O,{key:2},q(r(_).data,s=>(m(),u("tr",{key:s.name,class:"hover:bg-gray-50 transition-colors"},[t("td",ct,[t("div",ut,d(s.name),1),t("div",gt,d(U(s.creation)),1)]),t("td",mt,d(s.party||"Unknown"),1),t("td",_t,d(s.phone_number),1),t("td",pt,d(L(s.duration)),1),t("td",xt,[t("span",{class:V(["inline-flex items-center px-2.5 py-0.5 rounded text-xs font-medium",H(s.call_status)])},d(s.call_status||"Unknown"),3)]),t("td",ft,[t("span",{class:V(["inline-flex items-center px-2.5 py-0.5 rounded text-xs font-medium",B(s.lead_status)])},d(s.lead_status||"Unknown"),3)]),t("td",vt,[g(r(h),{variant:"subtle",size:"sm",class:"text-[#4318FF] hover:bg-[#4318FF]/10",onClick:z=>R(s)},{default:i(()=>[yt]),_:2},1032,["onClick"]),g(r(h),{variant:"ghost",theme:"red",size:"sm",onClick:z=>j(s)},{default:i(()=>[g(r(F),{name:"trash-2",class:"h-4 w-4"})]),_:2},1032,["onClick"])])]))),128))])])]),g(r(T),{modelValue:n.value,"onUpdate:modelValue":e[8]||(e[8]=s=>n.value=s),options:{size:"2xl"}},{"body-title":i(()=>[t("h3",ht,"Call Details: "+d(a.value.name),1)]),"body-content":i(()=>[a.value?(m(),u("div",bt,[t("div",wt,[t("div",null,[Ct,t("a",{href:`/app/contact/${a.value.party}`,target:"_blank",class:"text-[#4318FF] hover:underline font-medium flex items-center gap-1"},[f(d(a.value.party)+" ",1),g(r(F),{name:"external-link",class:"h-3 w-3"})],8,kt)]),t("div",null,[Ft,t("div",{class:"font-mono text-gray-700 text-sm truncate",title:a.value.livekit_room},d(a.value.livekit_room||"N/A"),9,Lt)]),t("div",null,[Dt,t("div",Nt,d(L(a.value.duration)),1)])]),a.value.recording_url?(m(),u("div",St,[$t,t("audio",{controls:"",src:a.value.recording_url,class:"w-full rounded-md h-10"},null,8,Tt)])):a.value.call_status==="Completed"?(m(),u("div",Vt," \u26A0\uFE0F No recording available for this call. ")):A("",!0),t("div",At,[t("div",null,[It,C(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>a.value.call_status=s),class:"form-select w-full rounded-md border border-gray-200 bg-gray-50 px-3 py-2 text-sm text-gray-900 focus:border-gray-500 focus:bg-white focus:ring-0 transition-colors"},Et,512),[[I,a.value.call_status]])]),t("div",null,[jt,C(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>a.value.lead_status=s),class:"form-select w-full rounded-md border border-gray-200 bg-gray-50 px-3 py-2 text-sm text-gray-900 focus:border-gray-500 focus:bg-white focus:ring-0 transition-colors"},Kt,512),[[I,a.value.lead_status]])])]),t("div",null,[t("div",Ot,[qt,t("button",{onClick:e[3]||(e[3]=s=>c.value=!c.value),class:"text-xs text-[#4318FF] hover:text-[#3311CC] font-medium"},d(c.value?"Show Preview":"Edit Raw Text"),1)]),c.value?C((m(),u("textarea",{key:1,"onUpdate:modelValue":e[4]||(e[4]=s=>a.value.ai_summary=s),rows:"3",class:"w-full rounded-md border border-gray-200 bg-white px-3 py-2 text-sm text-gray-900 focus:bg-white focus:border-gray-500 focus:ring-0 transition-colors"},null,512)),[[M,a.value.ai_summary]]):(m(),u("div",{key:0,class:"w-full h-auto min-h-[5rem] overflow-y-auto rounded-md border border-gray-200 bg-gray-50 px-3 py-2 text-sm text-gray-800 leading-relaxed",innerHTML:D(a.value.ai_summary)},null,8,Qt))]),t("div",null,[t("div",Xt,[Yt,t("button",{onClick:e[5]||(e[5]=s=>x.value=!x.value),class:"text-xs text-[#4318FF] hover:text-[#3311CC] font-medium"},d(x.value?"Show Preview":"Edit Raw Text"),1)]),t("div",Zt,[x.value?C((m(),u("textarea",{key:1,"onUpdate:modelValue":e[6]||(e[6]=s=>a.value.transcription=s),rows:"10",class:"w-full rounded-md border border-gray-200 bg-white px-3 py-2 text-sm font-mono text-gray-600 focus:bg-white focus:border-gray-500 focus:ring-0 transition-colors"},null,512)),[[M,a.value.transcription]]):(m(),u("div",{key:0,class:"w-full h-64 overflow-y-auto rounded-md border border-gray-200 bg-gray-50 px-4 py-3 text-sm text-gray-800 leading-relaxed whitespace-pre-wrap",innerHTML:D(a.value.transcription)},null,8,te))])])])):A("",!0)]),actions:i(()=>[g(r(h),{variant:"subtle",onClick:e[7]||(e[7]=s=>n.value=!1)},{default:i(()=>[ee]),_:1}),g(r(h),{variant:"solid",loading:b.value,onClick:E,class:"!bg-[#4318FF] hover:!bg-[#3311CC] !text-white border-transparent"},{default:i(()=>[se]),_:1},8,["loading"])]),_:1},8,["modelValue"]),g(r(T),{modelValue:l.value,"onUpdate:modelValue":e[10]||(e[10]=s=>l.value=s)},{"body-title":i(()=>[ae]),"body-content":i(()=>{var s;return[t("div",oe,[le,t("div",ne," ID: "+d((s=v.value)==null?void 0:s.name),1),re])]}),actions:i(()=>[g(r(h),{variant:"subtle",onClick:e[9]||(e[9]=s=>l.value=!1)},{default:i(()=>[ie]),_:1}),g(r(h),{variant:"solid",theme:"red",loading:w.value,onClick:P},{default:i(()=>[de]),_:1},8,["loading"])]),_:1},8,["modelValue"])]))}};export{ge as default};
