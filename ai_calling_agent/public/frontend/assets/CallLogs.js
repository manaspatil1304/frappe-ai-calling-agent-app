var O=Object.defineProperty;var S=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var $=(y,i,n)=>i in y?O(y,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):y[i]=n,A=(y,i)=>{for(var n in i||(i={}))W.call(i,n)&&$(y,n,i[n]);if(S)for(var n of S(i))G.call(i,n)&&$(y,n,i[n]);return y};var L=(y,i,n)=>new Promise((r,f)=>{var w=g=>{try{v(n.next(g))}catch(c){f(c)}},_=g=>{try{v(n.throw(g))}catch(c){f(c)}},v=g=>g.done?r(g.value):Promise.resolve(g.value).then(w,_);v((n=n.apply(y,i)).next())});import{r as h,c as J,b as m,d as e,t as d,u as o,e as l,w as p,F as q,f as K,o as x,i as u,j as b,B as k,k as T,l as D,m as I,v as U,g as Q,D as M}from"./index.js";import{B as X}from"./Badge.js";const Y={class:"max-w-7xl mx-auto space-y-6"},Z={class:"flex flex-col sm:flex-row sm:items-center justify-between gap-4"},ee={class:"flex items-center gap-2 text-gray-500 mt-1"},te={class:"text-sm"},se={class:"flex items-center gap-3"},oe={class:"relative hidden sm:block"},re={class:"bg-white rounded-2xl border border-gray-200 shadow-soft overflow-hidden"},ae={class:"overflow-x-auto"},le={class:"w-full text-left border-collapse"},ne={class:"divide-y divide-gray-100"},ie={key:0},de={key:1},ue={colspan:"5",class:"px-6 py-16 text-center text-gray-500"},ge={class:"px-6 py-4"},ce={class:"flex items-center gap-3"},pe={class:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-500 border border-gray-200"},me={class:"font-bold text-gray-900 group-hover:text-primary-600 transition-colors"},xe={class:"text-xs text-gray-500 font-mono mt-0.5"},be={class:"px-6 py-4"},ye={class:"flex flex-col gap-1"},ve={class:"flex items-center text-sm text-gray-900 font-medium"},fe={class:"flex items-center text-xs text-gray-500"},he={class:"px-6 py-4"},we={class:"px-6 py-4"},_e={class:"inline-flex items-center px-2.5 py-0.5 rounded text-xs font-medium bg-white border border-gray-200 shadow-sm"},ke={class:"px-6 py-4 text-right"},Ce={class:"flex items-center justify-end gap-2"},De=["onClick"],Le=["onClick"],Ve={class:"px-6 py-4 border-t border-gray-200 flex items-center justify-between bg-gray-50/50"},Ne={class:"flex gap-2"},Se={class:"p-1 rounded hover:bg-white hover:shadow-sm text-gray-400 hover:text-gray-600 disabled:opacity-50",disabled:""},$e={class:"p-1 rounded hover:bg-white hover:shadow-sm text-gray-400 hover:text-gray-600 disabled:opacity-50",disabled:""},Ae={class:"text-xl font-bold flex items-center gap-3"},Te={class:"p-2 bg-primary-100 rounded-lg text-primary-600"},Ie={class:"ml-auto text-sm font-normal text-gray-400 bg-gray-50 px-2 py-1 rounded border border-gray-200 font-mono"},Ue={key:0,class:"mt-6 space-y-8"},Me={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},je={class:"bg-white p-4 rounded-xl border border-gray-200 shadow-sm relative overflow-hidden group"},Be={class:"relative z-10"},Fe={class:"font-bold text-gray-900 truncate"},He={class:"text-xs text-primary-600 mt-1 font-mono"},ze={class:"bg-white p-4 rounded-xl border border-gray-200 shadow-sm relative overflow-hidden group"},Ee={class:"relative z-10"},Re={class:"font-bold text-gray-900 text-xl font-mono"},Pe={class:"bg-white p-4 rounded-xl border border-gray-200 shadow-sm relative overflow-hidden group"},Oe={class:"relative z-10"},We={key:0,class:"p-5 rounded-xl bg-gray-900 text-white shadow-lg"},Ge={class:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-3 flex items-center gap-2"},Je=["src"],qe={key:1,class:"flex items-center justify-center p-6 border-2 border-dashed border-gray-200 rounded-xl bg-gray-50 text-gray-400"},Ke={class:"bg-gradient-to-br from-indigo-50 to-white p-6 rounded-2xl border border-indigo-100 shadow-sm"},Qe={class:"flex justify-between items-center mb-4"},Xe={class:"text-sm font-bold text-indigo-900 flex items-center gap-2"},Ye={class:"p-1 bg-indigo-200 rounded text-indigo-700"},Ze=["innerHTML"],et={class:"grid grid-cols-1 md:grid-cols-2 gap-6 bg-gray-50/50 p-6 rounded-2xl border border-gray-200"},tt={class:"flex justify-between items-center mb-2 px-1"},st={class:"relative"},ot=["innerHTML"],rt={class:"bg-red-50 p-2 rounded-full w-fit mb-2"},at={class:"mt-4 p-3 bg-gray-50 rounded-lg border border-gray-200 font-mono text-xs text-gray-600"},dt={__name:"CallLogs",setup(y){const i=h(!1),n=h(!1),r=h({}),f=h(null),w=h(!1),_=h(!1),v=h(!1),g=h(!1),c=J({url:"frappe.client.get_list",params:{doctype:"AI Call Log",fields:["name","party","party_type","phone_number","call_status","lead_status","livekit_room","transcription","ai_summary","creation","duration","recording_url"],order_by:"creation desc",limit:50},auto:!0});function V(a){if(!a)return"00:00";const t=Math.floor(a/60),C=Math.floor(a%60);return`${t.toString().padStart(2,"0")}:${C.toString().padStart(2,"0")}`}function j(a){return a?new Date(a).toLocaleString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):""}function B(a){const t=(a||"").trim();return t==="Completed"?"bg-green-50 text-green-700 border border-green-200":t==="Failed"?"bg-red-50 text-red-700 border border-red-200":t==="Initiated"?"bg-blue-50 text-blue-700 border border-blue-200":t==="No Answer"?"bg-orange-50 text-orange-700 border border-orange-200":"bg-gray-50 text-gray-700 border border-gray-200"}function F(a){const t=(a||"").trim();return t==="Completed"?"bg-green-500":t==="Failed"?"bg-red-500":t==="Initiated"?"bg-blue-500":t==="No Answer"?"bg-orange-500":"bg-gray-400"}function N(a){return a?a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,'<strong class="text-gray-900 font-bold">$1</strong>').replace(/(Alex \(AI\):)/g,'<span class="text-primary-600 font-bold">$1</span>').replace(/(User:)/g,'<span class="text-gray-700 font-bold">$1</span>').replace(/^- (.*)/gm,'<li class="ml-4 list-disc text-gray-600">$1</li>'):'<span class="text-gray-400 italic">No detailed summary available.</span>'}function H(a){r.value=A({},a),v.value=!1,g.value=!1,i.value=!0}function z(){return L(this,null,function*(){w.value=!0;try{yield fetch(`/api/resource/AI Call Log/${r.value.name}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({call_status:r.value.call_status,lead_status:r.value.lead_status,ai_summary:r.value.ai_summary,transcription:r.value.transcription})}),yield c.fetch(),i.value=!1}catch(a){console.error(a)}finally{w.value=!1}})}function E(a){f.value=a,n.value=!0}function R(){return L(this,null,function*(){if(!!f.value){_.value=!0;try{if((yield fetch(`/api/resource/AI Call Log/${f.value.name}`,{method:"DELETE"})).ok)yield c.fetch(),n.value=!1,f.value=null;else throw new Error("Server returned error")}catch(a){console.error(a)}finally{_.value=!1}}})}return(a,t)=>{var C;return x(),m("div",Y,[e("header",Z,[e("div",null,[t[13]||(t[13]=e("h1",{class:"text-3xl font-bold text-gray-900 tracking-tight"},"Call History",-1)),e("div",ee,[t[11]||(t[11]=e("span",{class:"text-sm"},"Log of all AI voice interactions",-1)),t[12]||(t[12]=e("span",{class:"w-1 h-1 bg-gray-300 rounded-full"},null,-1)),e("span",te,d(((C=o(c).data)==null?void 0:C.length)||0)+" calls recorded",1)])]),e("div",se,[e("div",oe,[l(o(u),{name:"search",class:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),t[14]||(t[14]=e("input",{type:"text",placeholder:"Search by phone...",class:"pl-9 pr-4 py-2 border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 w-64 transition-shadow bg-white"},null,-1))]),l(o(k),{variant:"solid",class:"!bg-primary-600 hover:!bg-primary-700 !text-white !border-transparent !rounded-xl shadow-md shadow-primary-500/20",loading:o(c).loading,onClick:t[0]||(t[0]=s=>o(c).fetch())},{prefix:p(()=>[l(o(u),{name:"refresh-cw",class:"h-4 w-4"})]),default:p(()=>[t[15]||(t[15]=b(" Refresh ",-1))]),_:1},8,["loading"])])]),e("div",re,[e("div",ae,[e("table",le,[t[19]||(t[19]=e("thead",null,[e("tr",{class:"bg-gray-50/50 border-b border-gray-200"},[e("th",{class:"px-6 py-4 text-xs font-semibold text-gray-500 uppercase tracking-wider"},"Contact Details"),e("th",{class:"px-6 py-4 text-xs font-semibold text-gray-500 uppercase tracking-wider"},"Date & Duration"),e("th",{class:"px-6 py-4 text-xs font-semibold text-gray-500 uppercase tracking-wider"},"Call Outcome"),e("th",{class:"px-6 py-4 text-xs font-semibold text-gray-500 uppercase tracking-wider"},"Lead Status"),e("th",{class:"px-6 py-4 text-xs font-semibold text-gray-500 uppercase tracking-wider text-right"},"Actions")])],-1)),e("tbody",ne,[o(c).loading?(x(),m("tr",ie,[...t[16]||(t[16]=[e("td",{colspan:"5",class:"px-6 py-12 text-center text-gray-500"},[e("div",{class:"flex flex-col items-center animate-pulse"},[e("div",{class:"h-4 w-32 bg-gray-200 rounded mb-2"}),e("div",{class:"h-3 w-48 bg-gray-100 rounded"})])],-1)])])):!o(c).data||o(c).data.length===0?(x(),m("tr",de,[e("td",ue,[l(o(u),{name:"phone-off",class:"w-10 h-10 mx-auto text-gray-300 mb-3"}),t[17]||(t[17]=e("p",{class:"font-medium text-gray-900"},"No calls found",-1)),t[18]||(t[18]=e("p",{class:"text-sm mt-1"},"Start a campaign or call a contact to see logs here.",-1))])])):(x(!0),m(q,{key:2},K(o(c).data,s=>(x(),m("tr",{key:s.name,class:"group hover:bg-gray-50/80 transition-colors"},[e("td",ge,[e("div",ce,[e("div",pe,[l(o(u),{name:"user",class:"w-4 h-4"})]),e("div",null,[e("div",me,d(s.party||"Unknown Person"),1),e("div",xe,d(s.phone_number),1)])])]),e("td",be,[e("div",ye,[e("div",ve,d(j(s.creation).split(",")[0]),1),e("div",fe,[l(o(u),{name:"clock",class:"w-3 h-3 mr-1"}),b(" "+d(V(s.duration)),1)])])]),e("td",he,[e("span",{class:T(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold border",B(s.call_status)])},[e("span",{class:T(["w-1.5 h-1.5 rounded-full mr-1.5",F(s.call_status)])},null,2),b(" "+d(s.call_status||"Unknown"),1)],2)]),e("td",we,[e("span",_e,d(s.lead_status||"Unclassified"),1)]),e("td",ke,[e("div",Ce,[e("button",{onClick:P=>H(s),class:"p-2 bg-white border border-gray-200 rounded-lg text-gray-600 hover:text-primary-600 hover:border-primary-200 hover:shadow-sm transition-all",title:"View Details"},[l(o(u),{name:"eye",class:"w-4 h-4"})],8,De),e("button",{onClick:P=>E(s),class:"p-2 bg-white border border-gray-200 rounded-lg text-gray-600 hover:text-red-600 hover:border-red-200 hover:shadow-sm transition-all",title:"Delete Log"},[l(o(u),{name:"trash-2",class:"w-4 h-4"})],8,Le)])])]))),128))])])]),e("div",Ve,[t[20]||(t[20]=e("span",{class:"text-xs text-gray-500"},"Auto-loading latest 50 logs",-1)),e("div",Ne,[e("button",Se,[l(o(u),{name:"chevron-left",class:"w-4 h-4"})]),e("button",$e,[l(o(u),{name:"chevron-right",class:"w-4 h-4"})])])])]),l(o(M),{modelValue:i.value,"onUpdate:modelValue":t[8]||(t[8]=s=>i.value=s),options:{size:"2xl"}},{"body-title":p(()=>[e("h3",Ae,[e("div",Te,[l(o(u),{name:"phone-call",class:"w-5 h-5"})]),t[21]||(t[21]=e("span",null,"Call Analysis",-1)),e("span",Ie,d(r.value.name),1)])]),"body-content":p(()=>[r.value?(x(),m("div",Ue,[e("div",Me,[e("div",je,[t[23]||(t[23]=e("div",{class:"absolute top-0 right-0 w-16 h-16 bg-blue-50 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110"},null,-1)),e("div",Be,[t[22]||(t[22]=e("label",{class:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-1 block"},"Contact",-1)),e("div",Fe,d(r.value.party),1),e("div",He,d(r.value.phone_number),1)])]),e("div",ze,[t[25]||(t[25]=e("div",{class:"absolute top-0 right-0 w-16 h-16 bg-green-50 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110"},null,-1)),e("div",Ee,[t[24]||(t[24]=e("label",{class:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-1 block"},"Duration",-1)),e("div",Re,d(V(r.value.duration)),1)])]),e("div",Pe,[t[27]||(t[27]=e("div",{class:"absolute top-0 right-0 w-16 h-16 bg-orange-50 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110"},null,-1)),e("div",Oe,[t[26]||(t[26]=e("label",{class:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-1 block"},"Status",-1)),l(o(X),{theme:r.value.call_status==="Completed"?"green":"red"},{default:p(()=>[b(d(r.value.call_status),1)]),_:1},8,["theme"])])])]),r.value.recording_url?(x(),m("div",We,[e("label",Ge,[l(o(u),{name:"mic",class:"w-3 h-3"}),t[28]||(t[28]=b(" Voice Recording ",-1))]),e("audio",{controls:"",src:r.value.recording_url,class:"w-full h-10 rounded contrast-125 filter"},null,8,Je)])):(x(),m("div",qe,[l(o(u),{name:"mic-off",class:"w-5 h-5 mr-2"}),t[29]||(t[29]=b(" No recording available ",-1))])),e("div",Ke,[e("div",Qe,[e("label",Xe,[e("div",Ye,[l(o(u),{name:"cpu",class:"w-3 h-3"})]),t[30]||(t[30]=b(" AI Insights & Summary ",-1))]),e("button",{onClick:t[1]||(t[1]=s=>g.value=!g.value),class:"text-xs text-indigo-600 hover:text-indigo-800 font-bold bg-white px-2 py-1 rounded shadow-sm border border-indigo-100"},d(g.value?"Preview":"Edit"),1)]),g.value?D((x(),m("textarea",{key:1,"onUpdate:modelValue":t[2]||(t[2]=s=>r.value.ai_summary=s),rows:"4",class:"w-full rounded-xl border-indigo-200 bg-white px-4 py-3 text-sm focus:border-indigo-500 focus:ring-indigo-500 shadow-inner"},null,512)),[[I,r.value.ai_summary]]):(x(),m("div",{key:0,class:"text-sm text-gray-700 leading-relaxed prose-indigo max-w-none",innerHTML:N(r.value.ai_summary)},null,8,Ze))]),e("div",et,[e("div",null,[t[32]||(t[32]=e("label",{class:"block text-xs font-bold text-gray-500 uppercase mb-2"},"Lead Classification",-1)),D(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>r.value.lead_status=s),class:"block w-full rounded-lg border-gray-200 bg-white shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm py-2.5"},[...t[31]||(t[31]=[e("option",{value:"Hot"},"\u{1F525} Hot",-1),e("option",{value:"Warm"},"\u26C5 Warm",-1),e("option",{value:"Cold"},"\u2744\uFE0F Cold",-1),e("option",{value:"Negative"},"\u26D4 Negative",-1),e("option",{value:"Not a Lead"},"\u{1F937} Not a Lead",-1)])],512),[[U,r.value.lead_status]])]),e("div",null,[t[34]||(t[34]=e("label",{class:"block text-xs font-bold text-gray-500 uppercase mb-2"},"Technical Status",-1)),D(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>r.value.call_status=s),class:"block w-full rounded-lg border-gray-200 bg-white shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm py-2.5"},[...t[33]||(t[33]=[e("option",{value:"Completed"},"Completed",-1),e("option",{value:"No Answer"},"No Answer",-1),e("option",{value:"Failed"},"Failed",-1),e("option",{value:"Initiated"},"Initiated",-1)])],512),[[U,r.value.call_status]])])]),e("div",null,[e("div",tt,[t[35]||(t[35]=e("label",{class:"text-xs font-bold text-gray-500 uppercase"},"Full Transcription",-1)),e("button",{onClick:t[5]||(t[5]=s=>v.value=!v.value),class:"text-xs text-gray-400 hover:text-gray-600"},d(v.value?"View Formatted":"View Raw"),1)]),e("div",st,[v.value?D((x(),m("textarea",{key:1,"onUpdate:modelValue":t[6]||(t[6]=s=>r.value.transcription=s),rows:"10",class:"w-full rounded-xl border border-gray-200 bg-white px-5 py-4 text-xs font-mono leading-relaxed"},null,512)),[[I,r.value.transcription]]):(x(),m("div",{key:0,class:"w-full h-64 overflow-y-auto rounded-xl border border-gray-200 bg-gray-50 px-5 py-4 text-xs text-gray-600 font-mono leading-relaxed",innerHTML:N(r.value.transcription)},null,8,ot))])])])):Q("",!0)]),actions:p(()=>[l(o(k),{variant:"subtle",class:"hover:bg-gray-100",onClick:t[7]||(t[7]=s=>i.value=!1)},{default:p(()=>[...t[36]||(t[36]=[b("Close",-1)])]),_:1}),l(o(k),{variant:"solid",class:"!bg-primary-600 hover:!bg-primary-700 !text-white !rounded-xl shadow-lg shadow-primary-500/20",loading:w.value,onClick:z},{default:p(()=>[...t[37]||(t[37]=[b(" Save Updates ",-1)])]),_:1},8,["loading"])]),_:1},8,["modelValue"]),l(o(M),{modelValue:n.value,"onUpdate:modelValue":t[10]||(t[10]=s=>n.value=s),options:{size:"md"}},{"body-title":p(()=>[e("div",rt,[l(o(u),{name:"trash-2",class:"w-5 h-5 text-red-600"})]),t[38]||(t[38]=e("h3",{class:"text-xl font-bold text-gray-900"},"Delete Call Log?",-1))]),"body-content":p(()=>{var s;return[t[39]||(t[39]=e("p",{class:"text-gray-500 mt-2"}," Are you sure you want to permanently delete this call log? This will remove the recording and transcript as well. ",-1)),e("div",at," Log ID: "+d((s=f.value)==null?void 0:s.name),1)]}),actions:p(()=>[l(o(k),{variant:"subtle",onClick:t[9]||(t[9]=s=>n.value=!1)},{default:p(()=>[...t[40]||(t[40]=[b("Cancel",-1)])]),_:1}),l(o(k),{variant:"solid",theme:"red",loading:_.value,onClick:R},{default:p(()=>[...t[41]||(t[41]=[b("Confirm Delete",-1)])]),_:1},8,["loading"])]),_:1},8,["modelValue"])])}}};export{dt as default};
