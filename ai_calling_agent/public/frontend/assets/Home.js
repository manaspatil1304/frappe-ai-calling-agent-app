var Q=Object.defineProperty;var $=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var T=(_,g,u)=>g in _?Q(_,g,{enumerable:!0,configurable:!0,writable:!0,value:u}):_[g]=u,V=(_,g)=>{for(var u in g||(g={}))X.call(g,u)&&T(_,u,g[u]);if($)for(var u of $(g))Y.call(g,u)&&T(_,u,g[u]);return _};var H=(_,g,u)=>new Promise((o,h)=>{var b=v=>{try{l(u.next(v))}catch(f){h(f)}},C=v=>{try{l(u.throw(v))}catch(f){h(f)}},l=v=>v.done?o(v.value):Promise.resolve(v.value).then(b,C);l((u=u.apply(_,g)).next())});import{d as w,c as Z,v as I,e as c,f as t,g as k,w as p,u as n,B as S,t as r,F as N,h as M,i as F,x as tt,D as et,o as i,_ as U,y as R,n as B,l as y,z as A,A as P,C as z}from"./vendor.js";const st={class:"p-8 max-w-6xl mx-auto"},at={class:"flex justify-between items-center mb-8"},ot=t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900"},"AI Calling Agent"),t("p",{class:"text-gray-600 mt-1"},"Manage your AI sales team and campaigns")],-1),lt=y(" Refresh Data "),nt={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8"},rt={class:"bg-white p-6 rounded-lg shadow-sm border border-gray-100"},it=t("div",{class:"text-gray-500 text-sm font-medium"},"Total Calls",-1),dt={class:"text-3xl font-bold mt-2"},ct={class:"bg-white p-6 rounded-lg shadow-sm border border-gray-100"},ut=t("div",{class:"text-gray-500 text-sm font-medium"},"Hot Leads",-1),gt={class:"text-3xl font-bold mt-2 text-green-600"},mt={class:"bg-white p-6 rounded-lg shadow-sm border border-gray-100"},_t=t("div",{class:"text-gray-500 text-sm font-medium"},"Avg Duration",-1),vt={class:"text-3xl font-bold mt-2 text-[#4318FF]"},xt={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"},ht={class:"bg-white p-6 rounded-lg shadow-sm border border-gray-100"},pt=t("h3",{class:"text-lg font-bold text-gray-800 mb-4"},"Calls Per Day",-1),yt={class:"h-48 flex items-end gap-2 justify-between px-2"},bt={class:"relative w-full flex justify-center items-end h-32 bg-gray-50 rounded-md overflow-hidden"},ft={class:"absolute -top-8 bg-gray-900 text-white text-xs py-1 px-2 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-10"},wt={class:"text-xs text-gray-400 font-medium rotate-0 truncate w-full text-center"},kt={key:0,class:"w-full h-full flex items-center justify-center text-gray-400 text-sm"},Ct={class:"bg-white p-6 rounded-lg shadow-sm border border-gray-100"},Ft=t("h3",{class:"text-lg font-bold text-gray-800 mb-4"},"Leads by Status",-1),Lt={class:"space-y-4 h-48 overflow-y-auto pr-2"},St={class:"flex justify-between text-sm mb-1"},At={class:"font-medium text-gray-700"},Dt={class:"text-gray-500"},Nt={class:"w-full bg-gray-100 rounded-full h-2.5 overflow-hidden"},Mt={key:0,class:"w-full h-full flex items-center justify-center text-gray-400 text-sm"},jt={class:"bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden"},$t={class:"px-6 py-4 border-b border-gray-100 font-semibold text-gray-700 flex justify-between items-center"},Tt=t("span",null,"Recent Call Logs",-1),Vt={class:"text-xs text-gray-400"},Ht={key:0,class:"p-8 text-center text-gray-500"},It={key:1,class:"p-8 text-center text-gray-500"},Ut={key:2},Rt=["onClick"],Bt={class:"flex justify-between items-start"},Pt={class:"font-medium text-gray-900 group-hover:text-[#4318FF] transition-colors"},zt={class:"text-sm text-gray-500 mt-1 flex items-center gap-2"},Et=t("span",null,"\u2022",-1),Ot=t("span",null,"\u2022",-1),Wt={class:"font-mono text-gray-600 bg-gray-100 px-1.5 rounded text-xs"},Gt={class:"text-right"},Jt={class:"text-xs text-gray-400 mt-2"},Kt=t("div",{class:"mt-1 text-sm flex items-center gap-1 text-gray-500"},[t("span",null,"\u{1F916}"),y(),t("strong",null,"AI Summary")],-1),qt={key:0,class:"mt-2 text-sm text-gray-600 bg-gray-50 p-3 rounded border border-gray-100 line-clamp-2"},Qt={class:"p-4 bg-gray-50 text-center border-t border-gray-100"},Xt=y(" View More (Load 10) "),Yt={key:1,class:"text-xs text-gray-400"},Zt={class:"text-xl font-bold"},te={key:0,class:"mt-6 space-y-6"},ee={class:"grid grid-cols-1 md:grid-cols-3 gap-6 bg-gray-50 p-4 rounded-lg border border-gray-100"},se=t("label",{class:"block text-xs font-semibold text-gray-500 uppercase mb-1"},"Contact",-1),ae=["href"],oe=t("label",{class:"block text-xs font-semibold text-gray-500 uppercase mb-1"},"LiveKit Room",-1),le=["title"],ne=t("label",{class:"block text-xs font-semibold text-gray-500 uppercase mb-1"},"Duration",-1),re={class:"font-mono text-gray-900 font-bold"},ie={key:0,class:"bg-white border border-gray-200 p-4 rounded-lg shadow-sm"},de=t("label",{class:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2"},[t("span",{class:"text-lg"},"\u{1F399}\uFE0F"),y(" Call Recording ")],-1),ce=["src"],ue={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ge=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Call Status",-1),me=t("option",{value:"Pending"},"Pending",-1),_e=t("option",{value:"Initiated"},"Initiated",-1),ve=t("option",{value:"No Answer"},"No Answer",-1),xe=t("option",{value:"Completed"},"Completed",-1),he=t("option",{value:"Failed"},"Failed",-1),pe=[me,_e,ve,xe,he],ye=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Lead Status",-1),be=t("option",{value:"Hot"},"Hot",-1),fe=t("option",{value:"Warm"},"Warm",-1),we=t("option",{value:"Cold"},"Cold",-1),ke=t("option",{value:"Negative"},"Negative",-1),Ce=t("option",{value:"Not a Lead"},"Not a Lead",-1),Fe=[be,fe,we,ke,Ce],Le={class:"flex justify-between items-center mb-1"},Se=t("label",{class:"block text-sm font-medium text-gray-700 flex items-center gap-2"},[t("span",{class:"text-lg"},"\u{1F916}"),y(" AI Summary ")],-1),Ae=["innerHTML"],De={class:"flex justify-between items-center mb-1"},Ne=t("label",{class:"block text-sm font-medium text-gray-700"},"Full Transcription",-1),Me={class:"relative"},je=["innerHTML"],$e=y("Close"),Te=y(" Save Changes "),Ie={setup(_){const g=w(!1),u=w(!1),o=w({}),h=w(!1),b=w(!1),C=w(10),l=Z({url:"frappe.client.get_list",makeParams(s){return{doctype:"AI Call Log",fields:["name","phone_number","party","party_type","lead_status","ai_summary","transcription","call_status","livekit_room","creation","duration","recording_url"],order_by:"creation desc",limit:C.value}},auto:!0}),v=I(()=>{if(!l.data)return[];const s={};l.data.forEach(d=>{const m=d.creation.split(" ")[0];s[m]=(s[m]||0)+1});const a=Object.keys(s).sort().slice(-7),x=Math.max(...Object.values(s),1);return a.map(d=>{const m=new Date(d);return{date:d,label:m.toLocaleDateString("en-US",{month:"short",day:"numeric"}),count:s[d],percentage:s[d]/x*100}})}),f=I(()=>{if(!l.data)return[];const s={};l.data.forEach(d=>{const m=d.lead_status||"Unknown";s[m]=(s[m]||0)+1});const a=l.data.length,x={Hot:"bg-green-500",Warm:"bg-orange-400",Cold:"bg-blue-400",Negative:"bg-red-500",Unknown:"bg-gray-300","Not a Lead":"bg-gray-400"};return Object.keys(s).map(d=>({label:d,count:s[d],percentage:Math.round(s[d]/a*100),colorClass:x[d]||"bg-gray-500"})).sort((d,m)=>m.count-d.count)});function E(){C.value+=10,l.fetch()}function O(s){o.value=V({},s),h.value=!1,b.value=!1,g.value=!0}function W(){return H(this,null,function*(){u.value=!0;try{yield fetch(`/api/resource/AI Call Log/${o.value.name}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({call_status:o.value.call_status,lead_status:o.value.lead_status,ai_summary:o.value.ai_summary,transcription:o.value.transcription})}),yield l.fetch(),g.value=!1}catch(s){console.error(s),alert("Failed to save log.")}finally{u.value=!1}})}function G(s){if(!s||s.length===0)return"00:00";const a=s.filter(m=>m.duration>0);if(a.length===0)return"00:00";const x=a.reduce((m,e)=>m+(e.duration||0),0),d=Math.floor(x/a.length);return D(d)}function D(s){if(!s)return"00:00";const a=Math.floor(s/60),x=Math.floor(s%60);return`${a.toString().padStart(2,"0")}:${x.toString().padStart(2,"0")}`}function J(s){return s?new Date(s).toLocaleString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):""}function K(s){const a=(s||"").trim();return a==="Hot"?"bg-green-100 text-green-800":a==="Warm"?"bg-orange-100 text-orange-800":a==="Cold"?"bg-blue-100 text-blue-800":a==="Negative"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}function j(s){return s?s.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,'<strong class="text-gray-900 font-bold">$1</strong>').replace(/(Alex \(AI\):)/g,'<span class="text-[#4318FF] font-medium">$1</span>').replace(/^- (.*)/gm,'<li class="ml-4 list-disc">$1</li>'):'<span class="text-gray-400 italic">No data available.</span>'}function q(s){return s?s.replace(/\*\*/g,"").replace(/Alex \(AI\):/g,"AI:").substring(0,150)+"...":""}return(s,a)=>{var x,d,m;return i(),c("div",st,[t("div",at,[ot,k(n(S),{variant:"solid",class:"!bg-[#4318FF] hover:!bg-[#3311CC] !text-white border-transparent",onClick:a[0]||(a[0]=e=>n(l).fetch())},{prefix:p(()=>[k(n(U),{name:"refresh-cw",class:"h-4 w-4"})]),default:p(()=>[lt]),_:1})]),t("div",nt,[t("div",rt,[it,t("div",dt,r(((x=n(l).data)==null?void 0:x.length)||0),1)]),t("div",ct,[ut,t("div",gt,r(((d=n(l).data)==null?void 0:d.filter(e=>e.lead_status==="Hot").length)||0),1)]),t("div",mt,[_t,t("div",vt,r(G(n(l).data)),1)])]),t("div",xt,[t("div",ht,[pt,t("div",yt,[(i(!0),c(N,null,M(n(v),(e,L)=>(i(),c("div",{key:L,class:"flex flex-col items-center gap-2 group flex-1"},[t("div",bt,[t("div",{class:"w-full mx-1 bg-[#4318FF] rounded-t-sm transition-all duration-500 hover:bg-[#3311CC] relative group-hover:opacity-90",style:R({height:`${e.percentage}%`})},null,4),t("div",ft,r(e.count)+" calls ",1)]),t("span",wt,r(e.label),1)]))),128)),n(v).length===0?(i(),c("div",kt," No data available ")):F("",!0)])]),t("div",Ct,[Ft,t("div",Lt,[(i(!0),c(N,null,M(n(f),(e,L)=>(i(),c("div",{key:L},[t("div",St,[t("span",At,r(e.label),1),t("span",Dt,r(e.count)+" ("+r(e.percentage)+"%)",1)]),t("div",Nt,[t("div",{class:B(["h-2.5 rounded-full transition-all duration-500",e.colorClass]),style:R({width:`${e.percentage}%`})},null,6)])]))),128)),n(f).length===0?(i(),c("div",Mt," No data available ")):F("",!0)])])]),t("div",jt,[t("div",$t,[Tt,t("span",Vt,"Showing "+r(((m=n(l).data)==null?void 0:m.length)||0)+" calls",1)]),n(l).loading&&!n(l).data?(i(),c("div",Ht," Loading logs... ")):n(l).data&&n(l).data.length===0?(i(),c("div",It," No calls made yet. ")):(i(),c("div",Ut,[(i(!0),c(N,null,M(n(l).data,e=>(i(),c("div",{key:e.name,onClick:L=>O(e),class:"px-6 py-4 border-b border-gray-100 last:border-0 hover:bg-gray-50 transition-colors cursor-pointer group"},[t("div",Bt,[t("div",null,[t("div",Pt,r(e.phone_number),1),t("div",zt,[t("span",null,r(e.party||"Unknown Contact"),1),Et,t("span",null,r(J(e.creation)),1),Ot,t("span",Wt,r(D(e.duration)),1)])]),t("div",Gt,[t("span",{class:B(["inline-flex items-center px-2.5 py-0.5 rounded text-xs font-medium",K(e.lead_status)])},r(e.lead_status||"Unknown"),3),t("div",Jt,r(e.name),1)])]),Kt,e.ai_summary?(i(),c("div",qt,r(q(e.ai_summary)),1)):F("",!0)],8,Rt))),128)),t("div",Qt,[n(l).data.length>=C.value?(i(),tt(n(S),{key:0,variant:"outline",loading:n(l).loading,onClick:E,class:"w-full md:w-auto"},{default:p(()=>[Xt]),_:1},8,["loading"])):(i(),c("span",Yt,"All logs loaded"))])]))]),k(n(et),{modelValue:g.value,"onUpdate:modelValue":a[8]||(a[8]=e=>g.value=e),options:{size:"2xl"}},{"body-title":p(()=>[t("h3",Zt,"Call Details: "+r(o.value.name),1)]),"body-content":p(()=>[o.value?(i(),c("div",te,[t("div",ee,[t("div",null,[se,t("a",{href:`/app/contact/${o.value.party}`,target:"_blank",class:"text-[#4318FF] hover:underline font-medium flex items-center gap-1"},[y(r(o.value.party)+" ",1),k(n(U),{name:"external-link",class:"h-3 w-3"})],8,ae)]),t("div",null,[oe,t("div",{class:"font-mono text-gray-700 text-sm truncate",title:o.value.livekit_room},r(o.value.livekit_room||"N/A"),9,le)]),t("div",null,[ne,t("div",re,r(D(o.value.duration)),1)])]),o.value.recording_url?(i(),c("div",ie,[de,t("audio",{controls:"",src:o.value.recording_url,class:"w-full rounded-md h-10"},null,8,ce)])):F("",!0),t("div",ue,[t("div",null,[ge,A(t("select",{"onUpdate:modelValue":a[1]||(a[1]=e=>o.value.call_status=e),class:"form-select w-full rounded-md border border-gray-200 bg-gray-50 px-3 py-2 text-sm"},pe,512),[[P,o.value.call_status]])]),t("div",null,[ye,A(t("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>o.value.lead_status=e),class:"form-select w-full rounded-md border border-gray-200 bg-gray-50 px-3 py-2 text-sm"},Fe,512),[[P,o.value.lead_status]])])]),t("div",null,[t("div",Le,[Se,t("button",{onClick:a[3]||(a[3]=e=>b.value=!b.value),class:"text-xs text-[#4318FF] hover:text-[#3311CC] font-medium"},r(b.value?"Show Preview":"Edit Raw Text"),1)]),b.value?A((i(),c("textarea",{key:1,"onUpdate:modelValue":a[4]||(a[4]=e=>o.value.ai_summary=e),rows:"3",class:"w-full rounded-md border border-gray-200 bg-white px-3 py-2 text-sm"},null,512)),[[z,o.value.ai_summary]]):(i(),c("div",{key:0,class:"w-full h-auto min-h-[5rem] overflow-y-auto rounded-md border border-gray-200 bg-gray-50 px-3 py-2 text-sm text-gray-800 leading-relaxed",innerHTML:j(o.value.ai_summary)},null,8,Ae))]),t("div",null,[t("div",De,[Ne,t("button",{onClick:a[5]||(a[5]=e=>h.value=!h.value),class:"text-xs text-[#4318FF] hover:text-[#3311CC] font-medium"},r(h.value?"Show Preview":"Edit Raw Text"),1)]),t("div",Me,[h.value?A((i(),c("textarea",{key:1,"onUpdate:modelValue":a[6]||(a[6]=e=>o.value.transcription=e),rows:"10",class:"w-full rounded-md border border-gray-200 bg-white px-3 py-2 text-sm font-mono"},null,512)),[[z,o.value.transcription]]):(i(),c("div",{key:0,class:"w-full h-64 overflow-y-auto rounded-md border border-gray-200 bg-gray-50 px-4 py-3 text-sm text-gray-800 leading-relaxed whitespace-pre-wrap",innerHTML:j(o.value.transcription)},null,8,je))])])])):F("",!0)]),actions:p(()=>[k(n(S),{variant:"subtle",onClick:a[7]||(a[7]=e=>g.value=!1)},{default:p(()=>[$e]),_:1}),k(n(S),{variant:"solid",loading:u.value,onClick:W,class:"!bg-[#4318FF] hover:!bg-[#3311CC] !text-white border-transparent"},{default:p(()=>[Te]),_:1},8,["loading"])]),_:1},8,["modelValue"])])}}};export{Ie as default};
