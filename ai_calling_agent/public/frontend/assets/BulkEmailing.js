var D=(K,y,C)=>new Promise((S,w)=>{var E=p=>{try{f(C.next(p))}catch(G){w(G)}},_=p=>{try{f(C.throw(p))}catch(G){w(G)}},f=p=>p.done?S(p.value):Promise.resolve(p.value).then(E,_);f((C=C.apply(K,y)).next())});import{_ as ie,c as P,r as u,a as J,b as n,d as t,e as o,w as r,u as a,F as M,f as N,T as de,o as i,i as m,j as d,B as v,t as c,l as j,v as ue,m as U,D as W,C as me,E as ce,k as X,g as pe}from"./index.js";const ge={class:"max-w-7xl mx-auto space-y-6"},xe={class:"flex flex-col sm:flex-row sm:items-center justify-between gap-4"},ve={class:"flex gap-3"},fe={key:0,class:"grid grid-cols-1 md:grid-cols-3 gap-6"},ye={key:1,class:"flex flex-col items-center justify-center text-center py-20 bg-white rounded-2xl border border-gray-200 shadow-sm"},be={class:"w-20 h-20 bg-primary-50 rounded-full flex items-center justify-center mb-6"},he={class:"flex gap-3 justify-center"},we={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},_e=["onClick"],ke={class:"relative z-10"},Ce={class:"flex justify-between items-start mb-4"},Ee={class:"p-2.5 bg-gray-50 rounded-xl group-hover:bg-white group-hover:shadow-sm transition-all text-gray-500 group-hover:text-primary-600"},Ge={class:"font-bold text-lg text-gray-900 group-hover:text-primary-600 transition-colors mb-1 truncate pr-4"},je={class:"text-xs text-gray-400 font-medium"},Se={class:"mt-6 flex items-center justify-between"},Ve={class:"flex items-center gap-1 text-xs font-medium text-gray-400 group-hover:text-primary-600 transition-colors"},De={class:"flex items-center gap-2"},Me={class:"p-1.5 bg-indigo-100 rounded text-indigo-600"},Ne={class:"mt-4 space-y-5"},Te={class:"bg-indigo-50 border border-indigo-100 rounded-lg p-3 text-sm text-indigo-700 flex gap-2"},Ie=["value"],Ae={class:"text-xl font-bold flex items-center gap-2"},Fe={class:"p-1.5 bg-primary-100 text-primary-600 rounded-lg"},Ue={class:"mt-6 flex flex-col h-[600px] space-y-6"},Be={class:"bg-gray-50 p-5 rounded-xl border border-gray-200"},$e={class:"block text-sm font-bold text-gray-900 mb-2 flex items-center gap-2"},Le={class:"flex gap-2 mb-3"},Oe={key:0,class:"flex flex-wrap gap-2 max-h-24 overflow-y-auto custom-scrollbar p-1"},Re=["onClick"],ze={key:1,class:"text-xs text-gray-400 italic"},Pe={class:"flex-1 flex flex-col min-h-0 border border-gray-200 rounded-xl bg-white overflow-hidden"},Je={class:"bg-gray-50 px-4 py-3 border-b border-gray-100 flex justify-between items-center"},We={class:"text-sm font-bold text-gray-700 flex items-center gap-2"},Ke={class:"text-xs font-medium bg-white px-2 py-1 rounded border border-gray-200 text-gray-600"},Qe={key:0,class:"p-8 text-center text-gray-500"},Ye={key:1,class:"flex-1 overflow-y-auto custom-scrollbar"},qe={class:"min-w-full divide-y divide-gray-100"},He={class:"bg-gray-50 sticky top-0"},Xe={class:"px-6 py-3 w-10"},Ze=["checked"],et={class:"divide-y divide-gray-100 bg-white"},tt={class:"px-6 py-3"},st=["value"],lt={class:"px-6 py-3 text-sm font-medium text-gray-900"},at={class:"px-6 py-3 text-sm text-gray-500"},ot={class:"flex justify-between items-center px-2"},rt={class:"text-sm font-medium text-gray-900"},nt={class:"text-primary-600 font-bold ml-1 text-lg"},it={class:"flex justify-between items-center w-full pr-8"},dt={class:"flex items-center gap-3"},ut={class:"p-2 bg-indigo-50 text-indigo-600 rounded-lg"},mt={class:"text-xl font-bold"},ct={class:"mt-6 space-y-6"},pt={class:"bg-indigo-50 border border-indigo-100 text-indigo-900 px-4 py-3 rounded-xl flex items-center justify-between"},gt={class:"flex items-center gap-2 font-medium"},xt={class:"border border-gray-200 rounded-xl overflow-hidden"},vt={class:"max-h-32 overflow-y-auto overflow-x-auto p-2 bg-white space-y-1"},ft={class:"text-gray-900 font-medium"},yt={class:"text-gray-500 group-hover:text-gray-900 font-mono text-xs"},bt={class:"space-y-4 pt-2"},ht={class:"text-sm font-bold text-gray-900"},wt={class:"text-xs text-gray-500 mt-0.5 leading-relaxed"},_t={__name:"BulkEmailing",setup(K){const y=P({url:"ai_calling_agent.api.get_email_groups",auto:!0}),C=P({url:"ai_calling_agent.api.get_call_groups"}),S=P({url:"frappe.client.get_list",params:{doctype:"Contact",fields:["name","first_name","last_name","email_id"],limit:1e3}}),w=u(!1),E=u(!1),_=u(!1),f=u(""),p=u(""),G=u(!1),V=u(""),b=u([]),T=u(""),k=u([]),L=u(!1),I=u(null),B=u([]),A=u(""),F=u(""),O=u(!1),h=u({show:!1,title:"",message:"",type:"success"}),$=J(()=>(S.data||[]).filter(l=>l.email_id)),Q=J(()=>$.value.length>0&&$.value.every(l=>b.value.includes(l.name))),R=J(()=>b.value.length+k.value.length);function g(l,e,s="success"){h.value={show:!0,title:l,message:e,type:s},setTimeout(()=>{h.value.show=!1},4e3)}function Y(){C.fetch(),f.value="",p.value="",w.value=!0}function Z(){return D(this,null,function*(){if(!(!f.value||!p.value)){G.value=!0;try{const l=yield fetch("/api/method/ai_calling_agent.api.import_call_group_to_email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({call_group_name:f.value,new_title:p.value})}),e=yield l.json();l.ok?(g("Success",e.message||"Group imported successfully","success"),y.fetch(),w.value=!1):g("Error",e.message||"Import Failed","error")}catch(l){console.error(l),g("Error","An error occurred during import","error")}finally{G.value=!1}}})}function q(){S.fetch(),V.value="",b.value=[],k.value=[],T.value="",E.value=!0}function H(){const l=T.value.trim();if(!!l){if(!l.includes("@")||!l.includes(".")){g("Invalid Email","Please enter a valid email address.","error");return}k.value.includes(l)||k.value.push(l),T.value=""}}function ee(l){k.value.splice(l,1)}function te(){Q.value?b.value=[]:b.value=$.value.map(l=>l.name)}function se(){return D(this,null,function*(){if(!V.value||R.value===0)return;L.value=!0;const l=b.value.map(x=>{const z=S.data.find(ne=>ne.name===x);return{name:z.name,email:z.email_id}}),e=k.value.map(x=>({name:"External",email:x})),s=[...l,...e];try{yield fetch("/api/method/ai_calling_agent.api.create_email_group",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:V.value,members:JSON.stringify(s)})}),y.fetch(),E.value=!1,g("Success","Email group created successfully","success")}catch(x){console.error(x),g("Error","Failed to create group","error")}finally{L.value=!1}})}function le(l){return D(this,null,function*(){I.value=l,B.value=[],A.value="",F.value="";try{const s=yield(yield fetch(`/api/resource/AI Email Group/${l.name}`)).json();s.data&&s.data.members&&(B.value=s.data.members),_.value=!0}catch(e){console.error(e),g("Error","Failed to load group details","error")}})}function ae(){return D(this,null,function*(){if(!!I.value){O.value=!0;try{const l=yield fetch("/api/method/ai_calling_agent.api.trigger_email_campaign",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({group_name:I.value.name,subject:A.value,message:F.value})}),e=yield l.json();l.ok?(g("Campaign Sent",e.message||"Emails sent successfully","success"),_.value=!1):g("Error",e.message||"Failed","error")}catch(l){console.error(l),g("Error","Failed to start campaign","error")}finally{O.value=!1}}})}function oe(){return D(this,null,function*(){if(!!confirm("Are you sure you want to delete this email group?"))try{yield fetch(`/api/resource/AI Email Group/${I.value.name}`,{method:"DELETE"}),y.fetch(),_.value=!1,g("Deleted","Group deleted successfully","success")}catch(l){console.error(l),g("Error","Failed to delete","error")}})}function re(l){return l?new Date(l).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):""}return(l,e)=>(i(),n("div",ge,[t("header",xe,[e[16]||(e[16]=t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900 tracking-tight"},"Bulk Emailing"),t("p",{class:"text-sm text-gray-500 mt-1"},"Manage email lists and send targeted campaigns.")],-1)),t("div",ve,[o(a(v),{variant:"outline",onClick:Y,class:"bg-white hover:bg-gray-50"},{prefix:r(()=>[o(a(m),{name:"download-cloud",class:"h-4 w-4"})]),default:r(()=>[e[14]||(e[14]=d(" Import from Calls ",-1))]),_:1}),o(a(v),{variant:"solid",class:"!bg-primary-600 hover:!bg-primary-700 !text-white !rounded-xl shadow-lg shadow-primary-500/20",onClick:q},{prefix:r(()=>[o(a(m),{name:"plus",class:"h-4 w-4"})]),default:r(()=>[e[15]||(e[15]=d(" Create Email Group ",-1))]),_:1})])]),a(y).loading?(i(),n("div",fe,[(i(),n(M,null,N(3,s=>t("div",{key:s,class:"h-48 bg-white rounded-2xl border border-gray-100 shadow-sm animate-pulse"})),64))])):!a(y).data||a(y).data.length===0?(i(),n("div",ye,[t("div",be,[o(a(m),{name:"mail",class:"h-10 w-10 text-primary-300"})]),e[19]||(e[19]=t("h3",{class:"text-xl font-bold text-gray-900"},"No Email Lists Found",-1)),e[20]||(e[20]=t("p",{class:"text-gray-500 max-w-sm mt-2 mb-8 mx-auto"}," Create a new group or import contacts from your call logs to start sending emails. ",-1)),t("div",he,[o(a(v),{variant:"outline",onClick:Y},{default:r(()=>[...e[17]||(e[17]=[d(" Import Existing Group ",-1)])]),_:1}),o(a(v),{variant:"solid",class:"!bg-primary-600 hover:!bg-primary-700 !text-white",onClick:q},{default:r(()=>[...e[18]||(e[18]=[d(" Create New Group ",-1)])]),_:1})])])):(i(),n("div",we,[(i(!0),n(M,null,N(a(y).data,s=>(i(),n("div",{key:s.name,class:"group bg-white p-6 rounded-2xl border border-gray-200 shadow-sm hover:shadow-lg hover:border-primary-200 hover:-translate-y-1 transition-all duration-300 cursor-pointer flex flex-col justify-between relative overflow-hidden",onClick:x=>le(s)},[e[23]||(e[23]=t("div",{class:"absolute top-0 right-0 w-24 h-24 bg-gradient-to-br from-indigo-50 to-purple-50 rounded-bl-full -mr-6 -mt-6 transition-transform group-hover:scale-110"},null,-1)),t("div",ke,[t("div",Ce,[t("div",Ee,[o(a(m),{name:"mail",class:"h-5 w-5"})])]),t("h3",Ge,c(s.title),1),t("p",je," Created "+c(re(s.creation)),1),t("div",Se,[e[22]||(e[22]=t("span",{class:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-semibold bg-green-50 text-green-700 border border-green-100"},[t("span",{class:"w-1.5 h-1.5 rounded-full bg-green-500"}),d(" Ready ")],-1)),t("div",Ve,[e[21]||(e[21]=t("span",null,"Manage Campaign",-1)),o(a(m),{name:"arrow-right",class:"w-3 h-3"})])])])],8,_e))),128))])),o(a(W),{modelValue:w.value,"onUpdate:modelValue":e[3]||(e[3]=s=>w.value=s)},{"body-title":r(()=>[t("div",De,[t("div",Me,[o(a(m),{name:"download-cloud",class:"w-4 h-4"})]),e[24]||(e[24]=t("h3",{class:"text-lg font-bold"},"Import from Call Group",-1))])]),"body-content":r(()=>[t("div",Ne,[t("div",Te,[o(a(m),{name:"info",class:"w-4 h-4 mt-0.5 shrink-0"}),e[25]||(e[25]=t("p",null,"We'll automatically extract valid email addresses from the members of the selected call group.",-1))]),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-xs font-bold text-gray-500 uppercase mb-1.5"},"Source Call Group",-1)),j(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>f.value=s),class:"block w-full rounded-xl border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm py-2.5"},[e[26]||(e[26]=t("option",{disabled:"",value:""},"-- Select Group --",-1)),(i(!0),n(M,null,N(a(C).data,s=>(i(),n("option",{key:s.name,value:s.name},c(s.title),9,Ie))),128))],512),[[ue,f.value]])]),t("div",null,[e[28]||(e[28]=t("label",{class:"block text-xs font-bold text-gray-500 uppercase mb-1.5"},"New List Name",-1)),j(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>p.value=s),type:"text",placeholder:"e.g. Q3 Leads - Email Followup",class:"block w-full rounded-xl border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm py-2.5"},null,512),[[U,p.value]])])])]),actions:r(()=>[o(a(v),{variant:"subtle",onClick:e[2]||(e[2]=s=>w.value=!1)},{default:r(()=>[...e[29]||(e[29]=[d("Cancel",-1)])]),_:1}),o(a(v),{variant:"solid",class:"!bg-primary-600 hover:!bg-primary-700 !text-white",loading:G.value,disabled:!f.value||!p.value,onClick:Z},{default:r(()=>[...e[30]||(e[30]=[d(" Start Import ",-1)])]),_:1},8,["loading","disabled"])]),_:1},8,["modelValue"]),o(a(W),{modelValue:E.value,"onUpdate:modelValue":e[8]||(e[8]=s=>E.value=s),options:{size:"xl"}},{"body-title":r(()=>[t("h3",Ae,[t("div",Fe,[o(a(m),{name:"user-plus",class:"w-5 h-5"})]),e[31]||(e[31]=d(" Create Email Group ",-1))])]),"body-content":r(()=>[t("div",Ue,[t("div",null,[e[32]||(e[32]=t("label",{class:"block text-xs font-bold text-gray-500 uppercase mb-1.5"},"Group Title",-1)),j(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>V.value=s),type:"text",placeholder:"e.g. Newsletter Subscribers",class:"block w-full rounded-xl border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-lg py-3 px-4"},null,512),[[U,V.value]])]),t("div",Be,[t("label",$e,[o(a(m),{name:"edit-2",class:"w-4 h-4 text-gray-500"}),e[33]||(e[33]=d(" Manually Add Emails ",-1))]),t("div",Le,[j(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>T.value=s),onKeyup:me(H,["enter"]),type:"email",placeholder:"Enter email address...",class:"block flex-1 rounded-lg border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm"},null,544),[[U,T.value]]),o(a(v),{variant:"outline",onClick:H,class:"bg-white"},{default:r(()=>[...e[34]||(e[34]=[d("Add",-1)])]),_:1})]),k.value.length>0?(i(),n("div",Oe,[(i(!0),n(M,null,N(k.value,(s,x)=>(i(),n("div",{key:x,class:"bg-white border border-gray-200 text-gray-700 px-2.5 py-1 rounded-md text-xs font-medium flex items-center gap-2 shadow-sm"},[t("span",null,c(s),1),t("button",{onClick:z=>ee(x),class:"text-gray-400 hover:text-red-500 transition-colors"},[o(a(m),{name:"x",class:"h-3 w-3"})],8,Re)]))),128))])):(i(),n("div",ze," No manual emails added yet. Type an email above and press Enter. "))]),t("div",Pe,[t("div",Je,[t("span",We,[o(a(m),{name:"users",class:"w-4 h-4 text-gray-400"}),e[35]||(e[35]=d(" Select From Contacts ",-1))]),t("span",Ke,c(b.value.length)+" selected ",1)]),a(S).loading?(i(),n("div",Qe,[...e[36]||(e[36]=[t("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600 mx-auto mb-2"},null,-1),d(" Loading contacts... ",-1)])])):(i(),n("div",Ye,[t("table",qe,[t("thead",He,[t("tr",null,[t("th",Xe,[t("input",{type:"checkbox",onChange:te,checked:Q.value,class:"rounded border-gray-300 text-primary-600 focus:ring-primary-500 cursor-pointer"},null,40,Ze)]),e[37]||(e[37]=t("th",{class:"px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider"},"Name",-1)),e[38]||(e[38]=t("th",{class:"px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider"},"Email Address",-1))])]),t("tbody",et,[(i(!0),n(M,null,N($.value,s=>(i(),n("tr",{key:s.name,class:"hover:bg-gray-50 cursor-pointer transition-colors"},[t("td",tt,[j(t("input",{type:"checkbox",value:s.name,"onUpdate:modelValue":e[6]||(e[6]=x=>b.value=x),class:"rounded border-gray-300 text-primary-600 focus:ring-primary-500 cursor-pointer"},null,8,st),[[ce,b.value]])]),t("td",lt,c(s.first_name)+" "+c(s.last_name),1),t("td",at,c(s.email_id),1)]))),128))])])]))]),t("div",ot,[e[40]||(e[40]=t("div",{class:"text-xs text-gray-400"}," You can add both existing contacts and manual emails. ",-1)),t("div",rt,[e[39]||(e[39]=d(" Total Recipients: ",-1)),t("span",nt,c(R.value),1)])])])]),actions:r(()=>[o(a(v),{variant:"subtle",onClick:e[7]||(e[7]=s=>E.value=!1)},{default:r(()=>[...e[41]||(e[41]=[d("Cancel",-1)])]),_:1}),o(a(v),{variant:"solid",class:"!bg-primary-600 hover:!bg-primary-700 !text-white !rounded-lg px-6",loading:L.value,disabled:!V.value||R.value===0,onClick:se},{default:r(()=>[...e[42]||(e[42]=[d(" Create Group ",-1)])]),_:1},8,["loading","disabled"])]),_:1},8,["modelValue"]),o(a(W),{modelValue:_.value,"onUpdate:modelValue":e[12]||(e[12]=s=>_.value=s),options:{size:"xl"}},{"body-title":r(()=>{var s;return[t("div",it,[t("div",dt,[t("div",ut,[o(a(m),{name:"send",class:"w-5 h-5"})]),t("h3",mt,c((s=I.value)==null?void 0:s.title),1)])])]}),"body-content":r(()=>[t("div",ct,[t("div",pt,[t("div",gt,[o(a(m),{name:"users",class:"h-4 w-4"}),t("span",null,[e[43]||(e[43]=d("Recipients: ",-1)),t("strong",null,c(B.value.length),1)])]),t("button",{onClick:oe,class:"text-xs text-red-600 hover:text-red-800 font-semibold hover:underline"}," Delete Group ")]),t("div",xt,[e[44]||(e[44]=t("div",{class:"bg-gray-50 px-4 py-2 border-b border-gray-200 text-xs font-bold text-gray-500 uppercase"},"Recipient Preview",-1)),t("div",vt,[(i(!0),n(M,null,N(B.value,s=>(i(),n("div",{key:s.email,class:"flex justify-between px-3 py-1.5 hover:bg-gray-50 rounded text-sm group"},[t("span",ft,c(s.contact_name||"Guest User"),1),t("span",yt,c(s.email),1)]))),128))])]),t("div",bt,[t("div",null,[e[45]||(e[45]=t("label",{class:"block text-xs font-bold text-gray-500 uppercase mb-1.5 ml-1"},"Email Subject",-1)),j(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>A.value=s),type:"text",placeholder:"e.g. Exclusive Invitation: AI Calling Agent Demo",class:"block w-full rounded-xl border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 py-3 px-4 font-medium"},null,512),[[U,A.value]])]),t("div",null,[e[46]||(e[46]=t("label",{class:"block text-xs font-bold text-gray-500 uppercase mb-1.5 ml-1"},"Message Content",-1)),j(t("textarea",{"onUpdate:modelValue":e[10]||(e[10]=s=>F.value=s),rows:"8",placeholder:"Write your email content here...",class:"block w-full rounded-xl border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 p-4"},null,512),[[U,F.value]])])])])]),actions:r(()=>[o(a(v),{variant:"subtle",onClick:e[11]||(e[11]=s=>_.value=!1)},{default:r(()=>[...e[47]||(e[47]=[d("Cancel",-1)])]),_:1}),o(a(v),{variant:"solid",class:"!bg-primary-600 hover:!bg-primary-700 !text-white !rounded-lg px-6 shadow-lg shadow-primary-500/20",loading:O.value,disabled:!A.value||!F.value,onClick:ae},{prefix:r(()=>[o(a(m),{name:"send",class:"h-4 w-4"})]),default:r(()=>[e[48]||(e[48]=d(" Send Campaign Now ",-1))]),_:1},8,["loading","disabled"])]),_:1},8,["modelValue"]),o(de,{name:"slide-fade"},{default:r(()=>[h.value.show?(i(),n("div",{key:0,class:X(["fixed bottom-6 right-6 z-50 flex items-center gap-4 px-5 py-4 bg-white rounded-xl shadow-2xl border border-gray-100 max-w-md transform transition-all",h.value.type==="success"?"border-l-4 border-l-green-500":"border-l-4 border-l-red-500"])},[t("div",{class:X(["flex items-center justify-center w-10 h-10 rounded-full shrink-0",h.value.type==="success"?"bg-green-100 text-green-600":"bg-red-100 text-red-600"])},[o(a(m),{name:h.value.type==="success"?"check":"alert-circle",class:"h-5 w-5"},null,8,["name"])],2),t("div",null,[t("h4",ht,c(h.value.title),1),t("p",wt,c(h.value.message),1)]),t("button",{onClick:e[13]||(e[13]=s=>h.value.show=!1),class:"text-gray-400 hover:text-gray-600 ml-2"},[o(a(m),{name:"x",class:"w-4 h-4"})])],2)):pe("",!0)]),_:1})]))}};var Et=ie(_t,[["__scopeId","data-v-41a78b5c"]]);export{Et as default};
