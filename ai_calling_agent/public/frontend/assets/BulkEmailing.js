var S=(R,g,w)=>new Promise((G,b)=>{var F=c=>{try{_(w.next(c))}catch(C){b(C)}},y=c=>{try{_(w.throw(c))}catch(C){b(C)}},_=c=>c.done?G(c.value):Promise.resolve(c.value).then(F,y);_((w=w.apply(R,g)).next())});import{c as z,d,v as J,e as r,f as e,g as n,w as o,u as s,B as v,_ as x,F as N,h as T,D as L,o as i,t as u,z as k,A as oe,C as I,P as ne,Q as re,l as m}from"./vendor.js";const ie={class:"p-8 max-w-7xl mx-auto h-full flex flex-col"},de={class:"flex justify-between items-center mb-8"},ue=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"Bulk Emailing"),e("p",{class:"text-gray-600 mt-1"},"Manage email groups and campaigns")],-1),ce={class:"flex gap-2"},me=m(" Import from Call Group "),pe=m(" New Group "),_e={key:0,class:"flex-1 flex items-center justify-center"},fe=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4318FF]"},null,-1),ve=[fe],ge={key:1,class:"flex-1 flex flex-col items-center justify-center text-center opacity-80"},he={class:"bg-gray-50 p-6 rounded-full mb-4"},xe=e("h3",{class:"text-xl font-bold text-gray-900"},"No Email Groups",-1),be=e("p",{class:"text-gray-500 max-w-sm mt-2 mb-6"}," Import contacts from your call lists or create a new email group. ",-1),ye={key:2,class:"grid grid-cols-1 md:grid-cols-3 gap-6"},we=["onClick"],Fe={class:"flex justify-between items-start mb-2"},Ce={class:"font-bold text-lg text-gray-900 group-hover:text-[#4318FF] transition-colors"},ke={class:"text-xs text-gray-500 font-medium"},Ge={class:"mt-4 flex items-center gap-2 text-sm text-gray-600 bg-gray-50 p-2 rounded"},Ee=e("span",null,"Ready to send",-1),Se=e("h3",{class:"text-xl font-bold"},"Import from Call Group",-1),Ve={class:"mt-4 space-y-4"},je=e("p",{class:"text-sm text-gray-600"}," Select an existing Call Group. We will automatically fetch the email addresses for its members. ",-1),De=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Select Source Group",-1),Me=e("option",{disabled:"",value:""},"-- Select a Call Group --",-1),Ne=["value"],Te=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"New Email Group Name",-1),Ie=m("Cancel"),Ue=m(" Import & Create "),Ae=e("h3",{class:"text-xl font-bold"},"Create New Email Group",-1),Oe={class:"mt-4 h-[70vh] flex flex-col space-y-4"},$e=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Group Title",-1),Be={class:"bg-gray-50 p-4 rounded-lg border border-gray-200"},Pe=e("label",{class:"block text-sm font-bold text-gray-700 mb-2"},"Add Emails Manually",-1),ze={class:"flex gap-2 mb-3"},Je=["onKeyup"],Le=m("Add"),Re={key:0,class:"flex flex-wrap gap-2 max-h-24 overflow-y-auto"},Ke=["onClick"],We={key:1,class:"text-xs text-gray-400 italic"},Qe={class:"flex-1 flex flex-col min-h-0 border border-gray-200 rounded-lg"},Ye={class:"bg-gray-100 p-2 border-b border-gray-200 flex justify-between items-center"},qe=e("span",{class:"text-sm font-bold text-gray-700"},"Select from Contacts",-1),He={class:"text-xs text-gray-500"},Xe={key:0,class:"p-4 text-center"},Ze={key:1,class:"flex-1 overflow-y-auto bg-white"},et={class:"min-w-full divide-y divide-gray-200"},tt={class:"bg-gray-50 sticky top-0"},at={class:"px-4 py-2 w-10"},lt=["checked"],st=e("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"}," Name ",-1),ot=e("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"}," Email ",-1),nt={class:"divide-y divide-gray-200"},rt={class:"px-4 py-2"},it=["value"],dt={class:"px-4 py-2 text-sm font-medium text-gray-900"},ut={class:"px-4 py-2 text-sm text-gray-500"},ct={class:"text-right text-sm text-gray-600"},mt=m(" Total Recipients: "),pt=m("Cancel"),_t=m(" Create Group "),ft={class:"text-xl font-bold"},vt={class:"mt-4 space-y-4"},gt={class:"bg-blue-50 border border-blue-100 text-blue-700 px-4 py-3 rounded-md text-sm flex items-center gap-2"},ht=m("This group contains "),xt=m(" members."),bt={class:"max-h-32 overflow-y-auto border border-gray-200 rounded p-2 text-xs text-gray-600"},yt={class:"font-mono"},wt=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Email Subject",-1),Ft=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Email Content",-1),Ct={class:"flex justify-between w-full items-center"},kt=m(" Delete Group "),Gt={class:"flex gap-2"},Et=m("Close"),St=m(" Send Campaign "),Dt={setup(R){const g=z({url:"ai_calling_agent.api.get_email_groups",auto:!0}),w=z({url:"ai_calling_agent.api.get_call_groups"}),G=z({url:"frappe.client.get_list",params:{doctype:"Contact",fields:["name","first_name","last_name","email_id"],limit:1e3}}),b=d(!1),F=d(!1),y=d(!1),_=d(""),c=d(""),C=d(!1),E=d(""),f=d([]),V=d(""),h=d([]),O=d(!1),j=d(null),U=d([]),D=d(""),M=d(""),$=d(!1),A=J(()=>(G.data||[]).filter(l=>l.email_id)),K=J(()=>A.value.length>0&&A.value.every(l=>f.value.includes(l.name))),B=J(()=>f.value.length+h.value.length);function Q(){w.fetch(),_.value="",c.value="",b.value=!0}function Y(){return S(this,null,function*(){if(!(!_.value||!c.value)){C.value=!0;try{const l=yield fetch("/api/method/ai_calling_agent.api.import_call_group_to_email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({call_group_name:_.value,new_title:c.value})}),a=yield l.json();l.ok?(alert(a.message),g.fetch(),b.value=!1):alert(a.message||"Import Failed")}catch(l){console.error(l)}finally{C.value=!1}}})}function q(){G.fetch(),E.value="",f.value=[],h.value=[],V.value="",F.value=!0}function W(){const l=V.value.trim();if(!!l){if(!l.includes("@")||!l.includes(".")){alert("Please enter a valid email address.");return}h.value.includes(l)||h.value.push(l),V.value=""}}function H(l){h.value.splice(l,1)}function X(){K.value?f.value=[]:f.value=A.value.map(l=>l.name)}function Z(){return S(this,null,function*(){if(!E.value||B.value===0)return;O.value=!0;const l=f.value.map(p=>{const P=G.data.find(se=>se.name===p);return{name:P.name,email:P.email_id}}),a=h.value.map(p=>({name:"External",email:p})),t=[...l,...a];try{yield fetch("/api/method/ai_calling_agent.api.create_email_group",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:E.value,members:JSON.stringify(t)})}),g.fetch(),F.value=!1}catch(p){console.error(p)}finally{O.value=!1}})}function ee(l){return S(this,null,function*(){j.value=l,U.value=[],D.value="",M.value="";try{const t=yield(yield fetch(`/api/resource/AI Email Group/${l.name}`)).json();t.data&&t.data.members&&(U.value=t.data.members),y.value=!0}catch(a){console.error(a)}})}function te(){return S(this,null,function*(){if(!!j.value){$.value=!0;try{const l=yield fetch("/api/method/ai_calling_agent.api.trigger_email_campaign",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({group_name:j.value.name,subject:D.value,message:M.value})}),a=yield l.json();l.ok?(alert(a.message),y.value=!1):alert(a.message||"Failed")}catch(l){console.error(l),alert("Failed to start campaign")}finally{$.value=!1}}})}function ae(){return S(this,null,function*(){if(!!confirm("Are you sure you want to delete this email group?"))try{yield fetch(`/api/resource/AI Email Group/${j.value.name}`,{method:"DELETE"}),g.fetch(),y.value=!1}catch(l){console.error(l),alert("Failed to delete")}})}function le(l){return l?new Date(l).toLocaleDateString():""}return(l,a)=>(i(),r("div",ie,[e("div",de,[ue,e("div",ce,[n(s(v),{variant:"outline",onClick:Q},{prefix:o(()=>[n(s(x),{name:"download",class:"h-4 w-4"})]),default:o(()=>[me]),_:1}),n(s(v),{variant:"solid",class:"!bg-[#4318FF] hover:!bg-[#3311CC] !text-white border-transparent",onClick:q},{prefix:o(()=>[n(s(x),{name:"plus",class:"h-4 w-4"})]),default:o(()=>[pe]),_:1})])]),s(g).loading?(i(),r("div",_e,ve)):!s(g).data||s(g).data.length===0?(i(),r("div",ge,[e("div",he,[n(s(x),{name:"mail",class:"h-10 w-10 text-gray-400"})]),xe,be])):(i(),r("div",ye,[(i(!0),r(N,null,T(s(g).data,t=>(i(),r("div",{key:t.name,class:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm hover:shadow-md transition-all cursor-pointer group flex flex-col justify-between",onClick:p=>ee(t)},[e("div",null,[e("div",Fe,[e("h3",Ce,u(t.title),1),n(s(x),{name:"more-horizontal",class:"h-5 w-5 text-gray-400"})]),e("p",ke," Created on "+u(le(t.creation)),1)]),e("div",Ge,[n(s(x),{name:"mail",class:"h-4 w-4 text-[#4318FF]"}),Ee])],8,we))),128))])),n(s(L),{modelValue:b.value,"onUpdate:modelValue":a[3]||(a[3]=t=>b.value=t)},{"body-title":o(()=>[Se]),"body-content":o(()=>[e("div",Ve,[je,e("div",null,[De,k(e("select",{"onUpdate:modelValue":a[0]||(a[0]=t=>_.value=t),class:"w-full rounded-md border-gray-300 shadow-sm focus:border-[#4318FF] focus:ring-[#4318FF] sm:text-sm px-3 py-2 border"},[Me,(i(!0),r(N,null,T(s(w).data,t=>(i(),r("option",{key:t.name,value:t.name},u(t.title),9,Ne))),128))],512),[[oe,_.value]])]),e("div",null,[Te,k(e("input",{"onUpdate:modelValue":a[1]||(a[1]=t=>c.value=t),type:"text",placeholder:"e.g. Follow-up Campaign A",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-[#4318FF] focus:ring-[#4318FF] sm:text-sm px-3 py-2 border"},null,512),[[I,c.value]])])])]),actions:o(()=>[n(s(v),{variant:"subtle",onClick:a[2]||(a[2]=t=>b.value=!1)},{default:o(()=>[Ie]),_:1}),n(s(v),{variant:"solid",class:"!bg-[#4318FF] hover:!bg-[#3311CC] !text-white border-transparent",loading:C.value,disabled:!_.value||!c.value,onClick:Y},{default:o(()=>[Ue]),_:1},8,["loading","disabled"])]),_:1},8,["modelValue"]),n(s(L),{modelValue:F.value,"onUpdate:modelValue":a[8]||(a[8]=t=>F.value=t),options:{size:"xl"}},{"body-title":o(()=>[Ae]),"body-content":o(()=>[e("div",Oe,[e("div",null,[$e,k(e("input",{"onUpdate:modelValue":a[4]||(a[4]=t=>E.value=t),type:"text",placeholder:"e.g. Newsletter Subscribers",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-[#4318FF] focus:ring-[#4318FF] sm:text-sm px-3 py-2 border"},null,512),[[I,E.value]])]),e("div",Be,[Pe,e("div",ze,[k(e("input",{"onUpdate:modelValue":a[5]||(a[5]=t=>V.value=t),onKeyup:ne(W,["enter"]),type:"email",placeholder:"Enter email address (e.g. client@gmail.com)",class:"block flex-1 rounded-md border-gray-300 shadow-sm focus:border-[#4318FF] focus:ring-[#4318FF] sm:text-sm px-3 py-2 border"},null,40,Je),[[I,V.value]]),n(s(v),{variant:"outline",onClick:W},{default:o(()=>[Le]),_:1})]),h.value.length>0?(i(),r("div",Re,[(i(!0),r(N,null,T(h.value,(t,p)=>(i(),r("div",{key:p,class:"bg-white border border-gray-300 text-gray-700 px-2 py-1 rounded-md text-xs flex items-center gap-2"},[e("span",null,u(t),1),e("button",{onClick:P=>H(p),class:"text-red-500 hover:text-red-700"},[n(s(x),{name:"x",class:"h-3 w-3"})],8,Ke)]))),128))])):(i(),r("div",We," No manual emails added yet. "))]),e("div",Qe,[e("div",Ye,[qe,e("span",He,u(f.value.length)+" selected",1)]),s(G).loading?(i(),r("div",Xe," Loading contacts... ")):(i(),r("div",Ze,[e("table",et,[e("thead",tt,[e("tr",null,[e("th",at,[e("input",{type:"checkbox",onChange:X,checked:s(K),class:"rounded text-[#4318FF] focus:ring-[#4318FF]"},null,40,lt)]),st,ot])]),e("tbody",nt,[(i(!0),r(N,null,T(s(A),t=>(i(),r("tr",{key:t.name,class:"hover:bg-gray-50"},[e("td",rt,[k(e("input",{type:"checkbox",value:t.name,"onUpdate:modelValue":a[6]||(a[6]=p=>f.value=p),class:"rounded text-[#4318FF] focus:ring-[#4318FF]"},null,8,it),[[re,f.value]])]),e("td",dt,u(t.first_name)+" "+u(t.last_name),1),e("td",ut,u(t.email_id),1)]))),128))])])]))]),e("div",ct,[mt,e("strong",null,u(s(B)),1),m(" ("+u(f.value.length)+" Contacts + "+u(h.value.length)+" Manual) ",1)])])]),actions:o(()=>[n(s(v),{variant:"subtle",onClick:a[7]||(a[7]=t=>F.value=!1)},{default:o(()=>[pt]),_:1}),n(s(v),{variant:"solid",class:"!bg-[#4318FF] hover:!bg-[#3311CC] !text-white border-transparent",loading:O.value,disabled:!E.value||s(B)===0,onClick:Z},{default:o(()=>[_t]),_:1},8,["loading","disabled"])]),_:1},8,["modelValue"]),n(s(L),{modelValue:y.value,"onUpdate:modelValue":a[12]||(a[12]=t=>y.value=t),options:{size:"xl"}},{"body-title":o(()=>{var t;return[e("h3",ft,u((t=j.value)==null?void 0:t.title),1)]}),"body-content":o(()=>[e("div",vt,[e("div",gt,[n(s(x),{name:"info",class:"h-4 w-4"}),e("span",null,[ht,e("strong",null,u(U.value.length),1),xt])]),e("div",bt,[(i(!0),r(N,null,T(U.value,t=>(i(),r("div",{key:t.email,class:"flex justify-between py-1 border-b border-gray-100 last:border-0"},[e("span",null,u(t.contact_name||"Guest"),1),e("span",yt,u(t.email),1)]))),128))]),e("div",null,[wt,k(e("input",{"onUpdate:modelValue":a[9]||(a[9]=t=>D.value=t),type:"text",placeholder:"e.g. Exclusive Offer for You",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-[#4318FF] focus:ring-[#4318FF] sm:text-sm px-3 py-2 border"},null,512),[[I,D.value]])]),e("div",null,[Ft,k(e("textarea",{"onUpdate:modelValue":a[10]||(a[10]=t=>M.value=t),rows:"6",placeholder:"Type your message here...",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-[#4318FF] focus:ring-[#4318FF] sm:text-sm px-3 py-2 border"},null,512),[[I,M.value]])])])]),actions:o(()=>[e("div",Ct,[n(s(v),{variant:"ghost",theme:"red",class:"text-red-600 hover:bg-red-50",onClick:ae},{prefix:o(()=>[n(s(x),{name:"trash-2",class:"h-4 w-4"})]),default:o(()=>[kt]),_:1}),e("div",Gt,[n(s(v),{variant:"subtle",onClick:a[11]||(a[11]=t=>y.value=!1)},{default:o(()=>[Et]),_:1}),n(s(v),{variant:"solid",class:"!bg-[#4318FF] hover:!bg-[#3311CC] !text-white border-transparent",loading:$.value,disabled:!D.value||!M.value,onClick:te},{prefix:o(()=>[n(s(x),{name:"send",class:"h-4 w-4"})]),default:o(()=>[St]),_:1},8,["loading","disabled"])])])]),_:1},8,["modelValue"])]))}};export{Dt as default};
