var T=(z,_,d)=>new Promise((k,j)=>{var p=m=>{try{x(d.next(m))}catch(y){j(y)}},G=m=>{try{x(d.throw(m))}catch(y){j(y)}},x=m=>m.done?k(m.value):Promise.resolve(m.value).then(p,G);x((d=d.apply(z,_)).next())});import{_ as te,r as f,c as O,a as M,b as i,d as t,u as a,h as $,w as n,g as C,F as E,f as N,e as l,T as se,o,i as u,j as g,B as b,t as c,l as U,m as I,C as re,D as J,k as Y}from"./index.js";const ae={class:"max-w-7xl mx-auto space-y-6"},le={class:"flex flex-col sm:flex-row sm:items-center justify-between gap-4"},oe={key:0,class:"grid grid-cols-1 md:grid-cols-3 gap-6"},ne={key:1,class:"flex flex-col items-center justify-center text-center py-20 bg-white rounded-2xl border border-gray-200 shadow-sm"},ie={class:"w-20 h-20 bg-primary-50 rounded-full flex items-center justify-center mb-6"},de={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},ue=["onClick"],ce={class:"relative z-10"},pe={class:"flex justify-between items-start mb-4"},me={class:"p-2.5 bg-gray-50 rounded-xl group-hover:bg-white group-hover:shadow-sm transition-all text-gray-500 group-hover:text-primary-600"},ge={class:"font-bold text-lg text-gray-900 group-hover:text-primary-600 transition-colors mb-1 truncate pr-4"},fe={class:"text-xs text-gray-400 font-medium"},xe={class:"mt-6 flex items-center gap-4"},ye={class:"flex -space-x-3 overflow-hidden"},he={class:"w-8 h-8 rounded-full border-2 border-white bg-primary-100 flex items-center justify-center text-xs font-bold text-primary-600"},ve={class:"flex items-center gap-3"},be={class:"flex items-center justify-center w-8 h-8 rounded-full bg-primary-100 text-primary-600 font-bold text-sm border-2 border-white shadow-sm"},we={class:"text-xl font-bold text-gray-900"},_e={class:"mt-6 min-h-[400px]"},ke={key:0,class:"flex flex-col items-center justify-center h-full py-12"},Ce={class:"w-16 h-16 bg-gradient-to-br from-primary-100 to-indigo-50 rounded-2xl flex items-center justify-center mb-6 shadow-inner"},je={class:"w-full max-w-md space-y-4"},Se={key:1,class:"flex flex-col h-[500px]"},Ge={class:"mb-4 relative"},De={class:"flex-1 overflow-hidden border border-gray-200 rounded-xl bg-white flex flex-col"},Be={key:0,class:"p-8 text-center text-gray-500"},Te={key:1,class:"flex-1 flex flex-col items-center justify-center text-gray-400 p-8"},$e={key:2,class:"flex-1 overflow-y-auto custom-scrollbar"},Ee={class:"min-w-full divide-y divide-gray-100"},Ne={class:"bg-gray-50 sticky top-0 z-10"},Ve={scope:"col",class:"px-6 py-3 text-left w-10 bg-gray-50"},Le=["checked"],ze={class:"bg-white divide-y divide-gray-100"},Ae=["onClick"],Pe={class:"px-6 py-4 whitespace-nowrap"},Fe=["checked"],Oe={class:"px-6 py-4 whitespace-nowrap"},Me={class:"flex items-center gap-3"},Ue={class:"w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-xs font-bold text-gray-500"},Ie={class:"font-medium text-gray-900"},Je={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 font-mono"},Ye={class:"mt-3 flex justify-between items-center text-sm"},Ke={class:"font-bold text-primary-600 bg-primary-50 px-3 py-1 rounded-full border border-primary-100"},Re={class:"flex w-full justify-between items-center"},qe={class:"flex items-center gap-3"},Qe={class:"flex items-center gap-2"},He={class:"flex items-center gap-2"},We={class:"flex items-center gap-3"},Xe={class:"p-2 bg-primary-50 text-primary-600 rounded-lg"},Ze={class:"text-xl font-bold text-gray-900"},et={class:"text-xs text-gray-500 font-normal mt-0.5"},tt={class:"mt-6 flex flex-col h-[500px]"},st={class:"bg-blue-50 border border-blue-100 rounded-xl p-4 mb-4 flex items-start gap-3"},rt={class:"flex-1 overflow-hidden border border-gray-200 rounded-xl bg-white flex flex-col"},at={key:0,class:"p-8 text-center text-gray-500 flex flex-col items-center justify-center h-full"},lt={key:1,class:"flex-1 overflow-y-auto overflow-x-auto custom-scrollbar"},ot={class:"min-w-full divide-y divide-gray-100"},nt={class:"bg-white divide-y divide-gray-100"},it={class:"px-6 py-4 text-sm font-medium text-gray-900"},dt={class:"flex items-center gap-3"},ut={class:"w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-xs font-bold text-gray-500 border border-white shadow-sm"},ct={class:"px-6 py-4 text-sm text-gray-500 font-mono"},pt={class:"flex w-full justify-between items-center bg-white pt-2"},mt={class:"flex gap-3"},gt={class:"text-sm font-bold text-gray-900"},ft={class:"text-xs text-gray-500 mt-0.5 leading-relaxed"},xt={__name:"BulkCalling",setup(z){const _=f(!1),d=f(1),k=f(""),j=f(""),p=f(new Set),G=f(!1),x=f(!1),m=f(null),y=f([]),V=f(!1),L=f(!1),h=f({show:!1,title:"",message:"",type:"success"}),w=O({url:"ai_calling_agent.api.get_call_groups",auto:!0}),D=O({url:"frappe.client.get_list",makeParams(){return{doctype:"Contact",fields:["name","first_name","last_name","mobile_no","phone"],limit:1e3}}}),S=M(()=>{if(!D.data)return[];const r=j.value.toLowerCase();return D.data.filter(e=>{if(!(e.mobile_no||e.phone))return!1;const B=`${e.first_name||""} ${e.last_name||""}`.toLowerCase(),ee=(e.mobile_no||e.phone||"").toLowerCase();return B.includes(r)||ee.includes(r)})}),A=M(()=>S.value.length>0&&S.value.every(r=>p.value.has(r.name)));function v(r,e,s="success"){h.value={show:!0,title:r,message:e,type:s},setTimeout(()=>{h.value.show=!1},4e3)}function P(){k.value="",p.value.clear(),d.value=1,D.fetch(),_.value=!0}function K(){_.value=!1}function R(r){p.value.has(r.name)?p.value.delete(r.name):p.value.add(r.name)}function q(){A.value?S.value.forEach(r=>p.value.delete(r.name)):S.value.forEach(r=>p.value.add(r.name))}function F(r){return r?r.substring(0,1).toUpperCase():"?"}function Q(r){return r?new Date(r).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):""}function H(){return T(this,null,function*(){G.value=!0;const r=[];p.value.forEach(e=>{const s=D.data.find(B=>B.name===e);s&&r.push({name:`${s.first_name||""} ${s.last_name||""}`.trim(),phone:s.mobile_no||s.phone})});try{const e=yield fetch("/api/method/ai_calling_agent.api.create_call_group",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:k.value,members:JSON.stringify(r)})}),s=yield e.json();e.ok?(w.fetch(),_.value=!1,v("Success","Call Group created successfully!","success")):v("Error",s.message||"Error creating group","error")}catch(e){console.error(e),v("Error","Failed to create group","error")}finally{G.value=!1}})}function W(r){return T(this,null,function*(){m.value=r,x.value=!0,V.value=!0,y.value=[];try{const s=yield(yield fetch(`/api/resource/Call Group/${r.name}`)).json();s.data&&(y.value=s.data.members||[])}catch(e){console.error(e),v("Error","Failed to load group details","error")}finally{V.value=!1}})}function X(){return T(this,null,function*(){if(!!m.value&&!!confirm(`Are you sure you want to call all ${y.value.length} members in this group?`)){L.value=!0;try{const r=yield fetch("/api/method/ai_calling_agent.api.trigger_bulk_call",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({group_name:m.value.name})}),e=yield r.json();r.ok?(v("Campaign Started","Bulk call campaign started successfully! Logs will appear in the dashboard.","success"),x.value=!1):v("Error",e.message||"Failed to start bulk call","error")}catch(r){console.error(r),v("Error","An error occurred","error")}finally{L.value=!1}}})}function Z(){return T(this,null,function*(){if(!!confirm("Are you sure you want to delete this group? This action cannot be undone."))try{yield fetch(`/api/resource/Call Group/${m.value.name}`,{method:"DELETE"}),w.fetch(),x.value=!1,v("Deleted","Group deleted successfully","success")}catch(r){console.error(r),v("Error","Failed to delete group","error")}})}return(r,e)=>(o(),i("div",ae,[t("header",le,[e[10]||(e[10]=t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900 tracking-tight"},"Bulk Calling"),t("p",{class:"text-sm text-gray-500 mt-1"},"Organize contacts into groups and launch AI calling campaigns.")],-1)),t("div",null,[a(w).data&&a(w).data.length>0?(o(),$(a(b),{key:0,variant:"solid",class:"!bg-primary-600 hover:!bg-primary-700 !text-white !rounded-xl shadow-lg shadow-primary-500/20",onClick:P},{prefix:n(()=>[l(a(u),{name:"plus",class:"h-4 w-4"})]),default:n(()=>[e[9]||(e[9]=g(" Create New Group ",-1))]),_:1})):C("",!0)])]),a(w).loading?(o(),i("div",oe,[(o(),i(E,null,N(3,s=>t("div",{key:s,class:"h-48 bg-white rounded-2xl border border-gray-100 shadow-sm animate-pulse"})),64))])):!a(w).data||a(w).data.length===0?(o(),i("div",ne,[t("div",ie,[l(a(u),{name:"layers",class:"h-10 w-10 text-primary-300"})]),e[12]||(e[12]=t("h3",{class:"text-xl font-bold text-gray-900"},"No Groups Created Yet",-1)),e[13]||(e[13]=t("p",{class:"text-gray-500 max-w-sm mt-2 mb-8 mx-auto"}," Groups allow you to target specific segments of your contacts for bulk calling. ",-1)),l(a(b),{variant:"solid",size:"lg",class:"!bg-primary-600 hover:!bg-primary-700 !text-white !rounded-xl shadow-lg shadow-primary-500/30",onClick:P},{prefix:n(()=>[l(a(u),{name:"plus",class:"h-4 w-4"})]),default:n(()=>[e[11]||(e[11]=g(" Create Your First Group ",-1))]),_:1})])):(o(),i("div",de,[(o(!0),i(E,null,N(a(w).data,s=>(o(),i("div",{key:s.name,class:"group bg-white p-6 rounded-2xl border border-gray-200 shadow-sm hover:shadow-lg hover:border-primary-200 hover:-translate-y-1 transition-all duration-300 cursor-pointer flex flex-col justify-between relative overflow-hidden",onClick:B=>W(s)},[e[17]||(e[17]=t("div",{class:"absolute top-0 right-0 w-24 h-24 bg-primary-50 rounded-bl-full -mr-6 -mt-6 transition-transform group-hover:scale-110"},null,-1)),t("div",ce,[t("div",pe,[t("div",me,[l(a(u),{name:"folder",class:"h-5 w-5"})])]),t("h3",ge,c(s.title),1),t("p",fe," Created "+c(Q(s.creation)),1),t("div",xe,[t("div",ye,[e[14]||(e[14]=t("div",{class:"w-8 h-8 rounded-full border-2 border-white bg-gray-100 flex items-center justify-center text-xs font-bold text-gray-400"},"#1",-1)),e[15]||(e[15]=t("div",{class:"w-8 h-8 rounded-full border-2 border-white bg-gray-200 flex items-center justify-center text-xs font-bold text-gray-500"},"#2",-1)),t("div",he,[l(a(u),{name:"users",class:"w-3 h-3"})])]),e[16]||(e[16]=t("span",{class:"text-xs font-semibold text-gray-500 group-hover:text-primary-600 transition-colors"},"View Members",-1))])])],8,ue))),128))])),l(a(J),{modelValue:_.value,"onUpdate:modelValue":e[5]||(e[5]=s=>_.value=s),options:{size:"xl"}},{"body-title":n(()=>[t("div",ve,[t("div",be,c(d.value),1),t("h3",we,c(d.value===1?"Name Your Group":"Add Members"),1)])]),"body-content":n(()=>[t("div",_e,[d.value===1?(o(),i("div",ke,[t("div",Ce,[l(a(u),{name:"edit-3",class:"w-8 h-8 text-primary-600"})]),t("div",je,[e[18]||(e[18]=t("label",{class:"block text-sm font-bold text-gray-700 text-center uppercase tracking-wider"},"Group Title",-1)),U(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>k.value=s),type:"text",placeholder:"e.g. Q4 Sales Outreach",class:"block w-full rounded-xl border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-lg py-3 px-4 text-center transition-shadow",autofocus:"",onKeydown:e[1]||(e[1]=re(s=>d.value=2,["enter"]))},null,544),[[I,k.value]]),e[19]||(e[19]=t("p",{class:"text-xs text-gray-400 text-center"},"Give your group a descriptive name to easily identify it later.",-1))])])):C("",!0),d.value===2?(o(),i("div",Se,[t("div",Ge,[l(a(u),{name:"search",class:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),U(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>j.value=s),type:"text",placeholder:"Search by name or phone...",class:"block w-full pl-9 pr-4 py-2.5 rounded-xl border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm transition-shadow"},null,512),[[I,j.value]])]),t("div",De,[a(D).loading?(o(),i("div",Be,[...e[20]||(e[20]=[t("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600 mx-auto mb-2"},null,-1),g(" Loading contacts... ",-1)])])):S.value.length===0?(o(),i("div",Te,[l(a(u),{name:"users",class:"w-8 h-8 mb-2 opacity-50"}),e[21]||(e[21]=g(" No contacts found matching your search. ",-1))])):(o(),i("div",$e,[t("table",Ee,[t("thead",Ne,[t("tr",null,[t("th",Ve,[t("input",{type:"checkbox",checked:A.value,onChange:q,class:"rounded border-gray-300 text-primary-600 focus:ring-primary-500 cursor-pointer"},null,40,Le)]),e[22]||(e[22]=t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider bg-gray-50"},"Name",-1)),e[23]||(e[23]=t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider bg-gray-50"},"Phone",-1))])]),t("tbody",ze,[(o(!0),i(E,null,N(S.value,s=>(o(),i("tr",{key:s.name,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:B=>R(s)},[t("td",Pe,[t("input",{type:"checkbox",checked:p.value.has(s.name),class:"rounded border-gray-300 text-primary-600 focus:ring-primary-500 pointer-events-none"},null,8,Fe)]),t("td",Oe,[t("div",Me,[t("div",Ue,c(F(s.first_name)),1),t("div",Ie,c(s.first_name)+" "+c(s.last_name),1)])]),t("td",Je,c(s.mobile_no||s.phone),1)],8,Ae))),128))])])]))]),t("div",Ye,[e[24]||(e[24]=t("span",{class:"text-gray-500"},"Select contacts to include in this group.",-1)),t("span",Ke,c(p.value.size)+" Selected ",1)])])):C("",!0)])]),actions:n(()=>[t("div",Re,[t("div",null,[d.value===2?(o(),$(a(b),{key:0,variant:"outline",onClick:e[3]||(e[3]=s=>d.value=1)},{default:n(()=>[...e[25]||(e[25]=[g("Back",-1)])]),_:1})):C("",!0)]),t("div",qe,[d.value===1?(o(),$(a(b),{key:0,variant:"solid",class:"!bg-primary-600 hover:!bg-primary-700 !text-white !rounded-lg px-6",disabled:!k.value,onClick:e[4]||(e[4]=s=>d.value=2)},{default:n(()=>[t("div",Qe,[e[26]||(e[26]=g(" Next Step ",-1)),l(a(u),{name:"arrow-right",class:"w-4 h-4"})])]),_:1},8,["disabled"])):C("",!0),d.value===2?(o(),$(a(b),{key:1,variant:"solid",class:"!bg-primary-600 hover:!bg-primary-700 !text-white !rounded-lg px-6",disabled:p.value.size===0,loading:G.value,onClick:H},{default:n(()=>[t("div",He,[e[27]||(e[27]=g(" Create Group ",-1)),l(a(u),{name:"check",class:"w-4 h-4"})])]),_:1},8,["disabled","loading"])):C("",!0),l(a(b),{variant:"subtle",onClick:K,class:"hover:bg-gray-200"},{default:n(()=>[...e[28]||(e[28]=[g("Cancel",-1)])]),_:1})])])]),_:1},8,["modelValue"]),l(a(J),{modelValue:x.value,"onUpdate:modelValue":e[7]||(e[7]=s=>x.value=s),options:{size:"2xl"}},{"body-title":n(()=>{var s;return[t("div",We,[t("div",Xe,[l(a(u),{name:"folder",class:"w-5 h-5"})]),t("div",null,[t("h3",Ze,c((s=m.value)==null?void 0:s.title),1),t("p",et,c(y.value.length)+" Members",1)])])]}),"body-content":n(()=>[t("div",tt,[t("div",st,[l(a(u),{name:"info",class:"w-5 h-5 text-blue-600 mt-0.5 shrink-0"}),e[29]||(e[29]=t("div",null,[t("h4",{class:"font-bold text-blue-900 text-sm"},"Target Audience"),t("p",{class:"text-sm text-blue-700 mt-1"},'Review the list below. Clicking "Start Bulk Calling" will queue calls for all valid numbers in this group.')],-1))]),t("div",rt,[V.value?(o(),i("div",at,[...e[30]||(e[30]=[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mb-2"},null,-1),g(" Loading members... ",-1)])])):(o(),i("div",lt,[t("table",ot,[e[32]||(e[32]=t("thead",{class:"bg-gray-50 sticky top-0"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider"},"Contact Name"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider"},"Phone"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider"},"Status")])],-1)),t("tbody",nt,[(o(!0),i(E,null,N(y.value,s=>(o(),i("tr",{key:s.name,class:"hover:bg-gray-50"},[t("td",it,[t("div",dt,[t("div",ut,c(F(s.contact_name)),1),g(" "+c(s.contact_name),1)])]),t("td",ct,c(s.phone_number),1),e[31]||(e[31]=t("td",{class:"px-6 py-4 text-sm"},[t("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-bold bg-gray-100 text-gray-600"},"Pending")],-1))]))),128))])])]))])])]),actions:n(()=>[t("div",pt,[l(a(b),{variant:"ghost",theme:"red",class:"text-red-600 hover:bg-red-50 hover:border-red-100 border border-transparent",onClick:Z},{prefix:n(()=>[l(a(u),{name:"trash-2",class:"h-4 w-4"})]),default:n(()=>[e[33]||(e[33]=g(" Delete Group ",-1))]),_:1}),t("div",mt,[l(a(b),{variant:"subtle",onClick:e[6]||(e[6]=s=>x.value=!1)},{default:n(()=>[...e[34]||(e[34]=[g("Close",-1)])]),_:1}),l(a(b),{variant:"solid",class:"!bg-primary-600 hover:!bg-primary-700 !text-white !rounded-lg shadow-lg shadow-primary-500/30 pl-4 pr-5",loading:L.value,onClick:X},{prefix:n(()=>[l(a(u),{name:"phone-call",class:"h-4 w-4"})]),default:n(()=>[e[35]||(e[35]=g(" Start Bulk Calling ",-1))]),_:1},8,["loading"])])])]),_:1},8,["modelValue"]),l(se,{name:"slide-fade"},{default:n(()=>[h.value.show?(o(),i("div",{key:0,class:Y(["fixed bottom-6 right-6 z-50 flex items-center gap-4 px-5 py-4 bg-white rounded-xl shadow-2xl border border-gray-100 max-w-md transform transition-all",h.value.type==="success"?"border-l-4 border-l-green-500":"border-l-4 border-l-red-500"])},[t("div",{class:Y(["flex items-center justify-center w-10 h-10 rounded-full shrink-0",h.value.type==="success"?"bg-green-100 text-green-600":"bg-red-100 text-red-600"])},[l(a(u),{name:h.value.type==="success"?"check":"alert-circle",class:"h-5 w-5"},null,8,["name"])],2),t("div",null,[t("h4",gt,c(h.value.title),1),t("p",ft,c(h.value.message),1)]),t("button",{onClick:e[8]||(e[8]=s=>h.value.show=!1),class:"text-gray-400 hover:text-gray-600 ml-2"},[l(a(u),{name:"x",class:"w-4 h-4"})])],2)):C("",!0)]),_:1})]))}};var vt=te(xt,[["__scopeId","data-v-5a2a7939"]]);export{vt as default};
