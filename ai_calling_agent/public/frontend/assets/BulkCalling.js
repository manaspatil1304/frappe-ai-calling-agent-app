var S=(V,v,c)=>new Promise((b,w)=>{var d=u=>{try{p(c.next(u))}catch(g){w(g)}},F=u=>{try{p(c.throw(u))}catch(g){w(g)}},p=u=>u.done?b(u.value):Promise.resolve(u.value).then(d,F);p((c=c.apply(V,v)).next())});import{d as h,c as z,v as A,e as r,f as e,u as a,x as G,w as l,B as m,i as C,g as i,_ as y,F as B,h as L,D as P,o as n,t as f,z as O,C as M,I as U,l as _}from"./vendor.js";const X={class:"p-8 max-w-7xl mx-auto h-full flex flex-col"},Z={class:"flex justify-between items-center mb-8"},ee=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"Bulk Calling"),e("p",{class:"text-gray-600 mt-1"},"Create groups and trigger AI campaigns")],-1),te=_(" New Group "),se={key:0,class:"flex-1 flex items-center justify-center"},ae=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4318FF]"},null,-1),oe=[ae],le={key:1,class:"flex-1 flex flex-col items-center justify-center text-center opacity-80"},ne={class:"bg-gray-50 p-6 rounded-full mb-4"},re=e("h3",{class:"text-xl font-bold text-gray-900"},"No groups found",-1),ie=e("p",{class:"text-gray-500 max-w-sm mt-2 mb-6"}," Create your first contact group to start a bulk calling campaign. ",-1),ce=_(" Create Group "),de={key:2,class:"grid grid-cols-1 md:grid-cols-3 gap-6"},ue=["onClick"],he={class:"flex justify-between items-start mb-2"},fe={class:"font-bold text-lg text-gray-900 group-hover:text-[#4318FF] transition-colors"},_e={class:"text-xs text-gray-500 font-medium"},pe={class:"mt-4 flex -space-x-2 overflow-hidden"},ge=e("div",{class:"inline-block h-8 w-8 rounded-full ring-2 ring-white bg-gray-100 flex items-center justify-center text-xs font-bold text-gray-500"}," # ",-1),me=e("div",{class:"inline-block h-8 w-8 rounded-full ring-2 ring-white bg-[#4318FF]/10 flex items-center justify-center text-xs font-bold text-[#4318FF]"}," AI ",-1),xe={class:"inline-block h-8 w-8 rounded-full ring-2 ring-white bg-gray-50 flex items-center justify-center text-xs text-gray-400"},ye={class:"mt-6 flex items-center justify-between border-t border-gray-100 pt-4"},ve=e("span",{class:"text-xs font-semibold text-gray-500"},"Click to view details",-1),be={class:"text-xl font-bold"},we={key:0,class:"mt-4 space-y-4"},ke=e("p",{class:"text-sm text-gray-600"},"Give your new contact group a clear name.",-1),Ce={class:"space-y-1"},Fe=e("label",{class:"block text-sm font-medium text-gray-700"},"Group Title",-1),je={key:1,class:"mt-4 flex flex-col h-[50vh]"},De={class:"mb-4"},Se={class:"flex-1 overflow-y-auto border border-gray-200 rounded-lg"},Ge={key:0,class:"p-4 text-center text-gray-500"},Ne={key:1,class:"p-4 text-center text-gray-500"},$e={key:2,class:"min-w-full divide-y divide-gray-200"},Be={class:"bg-gray-50 sticky top-0"},Le={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-10"},Ve=["checked"],Te=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Name ",-1),Ee=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Phone ",-1),ze={class:"bg-white divide-y divide-gray-200"},Ae=["onClick"],Pe={class:"px-6 py-4 whitespace-nowrap"},Oe=["checked"],Me={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Ue={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ie={class:"mt-2 text-sm text-gray-500 text-right"},Je={class:"flex w-full justify-between"},Re=_("Cancel"),Ye={class:"flex gap-2"},qe=_("Back"),He=_(" Next "),Ke=_(" Create Group "),Qe={class:"flex justify-between items-center w-full pr-8"},We={class:"text-xl font-bold"},Xe={class:"mt-4 h-[50vh] flex flex-col"},Ze={class:"flex-1 overflow-y-auto border border-gray-200 rounded-lg"},et={key:0,class:"p-6 text-center text-gray-500"},tt={key:1,class:"min-w-full divide-y divide-gray-200"},st=e("thead",{class:"bg-gray-50 sticky top-0"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Contact Name "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Phone "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Status ")])],-1),at={class:"bg-white divide-y divide-gray-200"},ot={class:"px-6 py-4 text-sm font-medium text-gray-900"},lt={class:"px-6 py-4 text-sm text-gray-500 font-mono"},nt={class:"px-6 py-4 text-sm text-gray-500"},rt=_("Pending"),it={class:"flex w-full justify-between items-center"},ct=_(" Delete Group "),dt={class:"flex gap-2"},ut=_("Close"),ht=_(" Start Bulk Calling "),pt={setup(V){const v=h(!1),c=h(1),b=h(""),w=h(""),d=h(new Set),F=h(!1),p=h(!1),u=h(null),g=h([]),N=h(!1),$=h(!1),x=z({url:"ai_calling_agent.api.get_call_groups",auto:!0}),j=z({url:"frappe.client.get_list",makeParams(){return{doctype:"Contact",fields:["name","first_name","last_name","mobile_no","phone"],limit:1e3}}}),k=A(()=>{if(!j.data)return[];const o=w.value.toLowerCase();return j.data.filter(s=>{if(!(s.mobile_no||s.phone))return!1;const D=`${s.first_name||""} ${s.last_name||""}`.toLowerCase(),W=(s.mobile_no||s.phone||"").toLowerCase();return D.includes(o)||W.includes(o)})}),T=A(()=>k.value.length>0&&k.value.every(o=>d.value.has(o.name)));function E(){b.value="",d.value.clear(),c.value=1,j.fetch(),v.value=!0}function I(){v.value=!1}function J(o){d.value.has(o.name)?d.value.delete(o.name):d.value.add(o.name)}function R(){T.value?k.value.forEach(o=>d.value.delete(o.name)):k.value.forEach(o=>d.value.add(o.name))}function Y(){return S(this,null,function*(){F.value=!0;const o=[];d.value.forEach(s=>{const t=j.data.find(D=>D.name===s);t&&o.push({name:`${t.first_name||""} ${t.last_name||""}`.trim(),phone:t.mobile_no||t.phone})});try{const s=yield fetch("/api/method/ai_calling_agent.api.create_call_group",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:b.value,members:JSON.stringify(o)})}),t=yield s.json();s.ok?(x.fetch(),v.value=!1):alert(t.message||"Error creating group")}catch(s){console.error(s),alert("Failed to create group")}finally{F.value=!1}})}function q(o){return S(this,null,function*(){u.value=o,p.value=!0,N.value=!0,g.value=[];try{const t=yield(yield fetch(`/api/resource/Call Group/${o.name}`)).json();t.data&&(g.value=t.data.members||[])}catch(s){console.error(s)}finally{N.value=!1}})}function H(){return S(this,null,function*(){if(!!u.value&&!!confirm(`Are you sure you want to call all ${g.value.length} members in this group?`)){$.value=!0;try{const o=yield fetch("/api/method/ai_calling_agent.api.trigger_bulk_call",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({group_name:u.value.name})}),s=yield o.json();o.ok?(alert("Bulk call campaign started successfully! Logs will appear in the dashboard."),p.value=!1):alert(s.message||"Failed to start bulk call")}catch(o){console.error(o),alert("An error occurred")}finally{$.value=!1}}})}function K(){return S(this,null,function*(){if(!!confirm("Are you sure you want to delete this group? This action cannot be undone."))try{yield fetch(`/api/resource/Call Group/${u.value.name}`,{method:"DELETE"}),x.fetch(),p.value=!1}catch(o){console.error(o),alert("Failed to delete group")}})}function Q(o){return o?new Date(o).toLocaleDateString():""}return(o,s)=>(n(),r("div",X,[e("div",Z,[ee,a(x).data&&a(x).data.length>0?(n(),G(a(m),{key:0,variant:"solid",class:"!bg-[#4318FF] hover:!bg-[#3311CC] !text-white border-transparent",onClick:E},{prefix:l(()=>[i(a(y),{name:"plus",class:"h-4 w-4"})]),default:l(()=>[te]),_:1})):C("",!0)]),a(x).loading?(n(),r("div",se,oe)):!a(x).data||a(x).data.length===0?(n(),r("div",le,[e("div",ne,[i(a(y),{name:"layers",class:"h-10 w-10 text-gray-400"})]),re,ie,i(a(m),{variant:"solid",size:"lg",class:"!bg-[#4318FF] hover:!bg-[#3311CC] !text-white border-transparent",onClick:E},{prefix:l(()=>[i(a(y),{name:"plus",class:"h-4 w-4"})]),default:l(()=>[ce]),_:1})])):(n(),r("div",de,[(n(!0),r(B,null,L(a(x).data,t=>(n(),r("div",{key:t.name,class:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm hover:shadow-md transition-all flex flex-col justify-between group cursor-pointer",onClick:D=>q(t)},[e("div",null,[e("div",he,[e("h3",fe,f(t.title),1),i(a(y),{name:"more-horizontal",class:"h-5 w-5 text-gray-400"})]),e("p",_e," Created on "+f(Q(t.creation)),1),e("div",pe,[ge,me,e("div",xe,[i(a(y),{name:"users",class:"h-3 w-3"})])])]),e("div",ye,[ve,i(a(y),{name:"arrow-right",class:"h-4 w-4 text-[#4318FF] opacity-0 group-hover:opacity-100 transition-opacity"})])],8,ue))),128))])),i(a(P),{modelValue:v.value,"onUpdate:modelValue":s[4]||(s[4]=t=>v.value=t),options:{size:"xl"}},{"body-title":l(()=>[e("h3",be,f(c.value===1?"Name Your Group":"Add Members"),1)]),"body-content":l(()=>[c.value===1?(n(),r("div",we,[ke,e("div",Ce,[Fe,O(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>b.value=t),type:"text",placeholder:"e.g. Real Estate Leads - Oct",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-[#4318FF] focus:ring-[#4318FF] sm:text-sm px-3 py-2 border"},null,512),[[M,b.value]])])])):C("",!0),c.value===2?(n(),r("div",je,[e("div",De,[O(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>w.value=t),type:"text",placeholder:"Search contacts...",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-[#4318FF] focus:ring-[#4318FF] sm:text-sm px-3 py-2 border"},null,512),[[M,w.value]])]),e("div",Se,[a(j).loading?(n(),r("div",Ge," Loading contacts... ")):a(k).length===0?(n(),r("div",Ne," No contacts found ")):(n(),r("table",$e,[e("thead",Be,[e("tr",null,[e("th",Le,[e("input",{type:"checkbox",checked:a(T),onChange:R,class:"rounded border-gray-300 text-[#4318FF] focus:ring-[#4318FF]"},null,40,Ve)]),Te,Ee])]),e("tbody",ze,[(n(!0),r(B,null,L(a(k),t=>(n(),r("tr",{key:t.name,class:"hover:bg-gray-50 cursor-pointer",onClick:D=>J(t)},[e("td",Pe,[e("input",{type:"checkbox",checked:d.value.has(t.name),class:"rounded border-gray-300 text-[#4318FF] focus:ring-[#4318FF] pointer-events-none"},null,8,Oe)]),e("td",Me,f(t.first_name)+" "+f(t.last_name),1),e("td",Ue,f(t.mobile_no||t.phone),1)],8,Ae))),128))])]))]),e("div",Ie,f(d.value.size)+" contacts selected ",1)])):C("",!0)]),actions:l(()=>[e("div",Je,[i(a(m),{variant:"subtle",onClick:I},{default:l(()=>[Re]),_:1}),e("div",Ye,[c.value===2?(n(),G(a(m),{key:0,variant:"outline",onClick:s[2]||(s[2]=t=>c.value=1)},{default:l(()=>[qe]),_:1})):C("",!0),c.value===1?(n(),G(a(m),{key:1,variant:"solid",class:"!bg-[#4318FF] !text-white",disabled:!b.value,onClick:s[3]||(s[3]=t=>c.value=2)},{default:l(()=>[He]),_:1},8,["disabled"])):C("",!0),c.value===2?(n(),G(a(m),{key:2,variant:"solid",class:"!bg-[#4318FF] !text-white",disabled:d.value.size===0,loading:F.value,onClick:Y},{default:l(()=>[Ke]),_:1},8,["disabled","loading"])):C("",!0)])])]),_:1},8,["modelValue"]),i(a(P),{modelValue:p.value,"onUpdate:modelValue":s[6]||(s[6]=t=>p.value=t),options:{size:"2xl"}},{"body-title":l(()=>{var t;return[e("div",Qe,[e("h3",We,f((t=u.value)==null?void 0:t.title),1),i(a(U),{theme:"gray",size:"lg"},{default:l(()=>[_(f(g.value.length)+" Members",1)]),_:1})])]}),"body-content":l(()=>[e("div",Xe,[e("div",Ze,[N.value?(n(),r("div",et," Loading members... ")):(n(),r("table",tt,[st,e("tbody",at,[(n(!0),r(B,null,L(g.value,t=>(n(),r("tr",{key:t.name},[e("td",ot,f(t.contact_name),1),e("td",lt,f(t.phone_number),1),e("td",nt,[i(a(U),{theme:"gray"},{default:l(()=>[rt]),_:1})])]))),128))])]))])])]),actions:l(()=>[e("div",it,[i(a(m),{variant:"ghost",theme:"red",class:"text-red-600 hover:bg-red-50",onClick:K},{prefix:l(()=>[i(a(y),{name:"trash-2",class:"h-4 w-4"})]),default:l(()=>[ct]),_:1}),e("div",dt,[i(a(m),{variant:"subtle",onClick:s[5]||(s[5]=t=>p.value=!1)},{default:l(()=>[ut]),_:1}),i(a(m),{variant:"solid",class:"!bg-[#4318FF] hover:!bg-[#3311CC] !text-white border-transparent",loading:$.value,onClick:H},{prefix:l(()=>[i(a(y),{name:"phone-call",class:"h-4 w-4"})]),default:l(()=>[ht]),_:1},8,["loading"])])])]),_:1},8,["modelValue"])]))}};export{pt as default};
